<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link type="text/css" rel="stylesheet" href='css\bootstrap.min.css'>
	<title>Mapa Web del INTA EEA Mendoza</title>
	<link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/dashboard/">
	<link rel="canonical" href="https://getbootstrap.com/docs/5.2/examples/modals/">
	<link href="modals.css" rel="stylesheet">
	<script src="geojson/ensayos.geojson" type="text/javascript"></script>
	<script src="geojson/personal.geojson" type="text/javascript"></script>
	<script src="geojson/inta.geojson" type="text/javascript"></script>
	<script src="permisos.txt" type="text/javascript"></script>
	<!-- JS -->
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
	integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
	crossorigin=""></script>
	<!-- Turf.js para c√°lculos geom√©tricos -->
	<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
	<!-- CSS -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
	integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
	crossorigin=""/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css"/>
	<!-- Repositorios en l√≠nea y locales -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css"/>
	<!--<link rel="stylesheet" href="libs/leaflet-measure-path.css"/>-->
	<link rel="stylesheet" href="./css/leaflet-sidebar.css"/>
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
	<!-- Leaflet Routing Machine -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
	<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
	<script src="libs/editable.js" ></script>
	<script src="./js/leaflet-sidebar.js"></script>
	<script src="https://kit.fontawesome.com/68fa6cffda.js" crossorigin="anonymous"></script>
	<script src="js/jquery-3.4.1.min.js" ></script>
	<!-- A√±ado un pluging de minimapa -->
	<script src="https://cdn.jsdelivr.net/gh/maneoverland/leaflet.WorldMiniMap@1.0.0/dist/Control.WorldMiniMap.js" integrity="sha512-PFw8St3qenU1/dmwCfiYYN/bRcqY1p3+sBATR+rZ6622eyXOk/8izVtlmm/k8qW7KbRIJsku838WCV5LMs6FCg==" crossorigin=""></script>
	<!--Clases para personalizar algunos elementos-->
	<meta name="theme-color" content="#712cf9"></meta>
	<style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }
        .lorem {
            font-style: italic;
            color: black;
        }
		.popups.leaflet-popup-tip,
		.popups.leaflet-popup-content-wrapper {
			background-color: #3182bd;
		}
		.popups.leaflet-popup-tip,
		.popups.leaflet-popup-content-wrapper {
			background-color: #3182bd;
		}
		a {
			text-align: center;
			display: inline;
			width: 100%;
		}
		
		/*Configuraci√≥n del √°rea del mapa*/
		#mapa {
			width:100%;
			height:87%;
			border: 0.5cm solid red;
			padding: 0px;
			margin: 0px;
		}
		
		/*B√∫squeda de unidades//Sectores, servicios y personas*/
		#sugerencias {
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
            background-color: red;
            width: 200px;
			position: absolute;
			z-index: 1002;
        }
        .sugerencias-item {
            padding: 5px;
            cursor: pointer;
			background-color: red;
			position: absolute;
			z-index: 1002;
        }
        .sugerencias-item:hover {
            background-color: blue;/*#f0f0f0;*/
        }
		
		/*Modal estad√≠sticas*/
		.modal-estadistico {
			position: absolute;
			min-width: 210px;
			min-height: 150px;
			max-width: 90vw;
			max-height: 90vh;
			background: rgba(255, 255, 255, 0.95);
			border: 1px solid #999;
			border-radius: 8px;
			box-shadow: 0 5px 15px rgba(0,0,0,0.3);
			z-index: 1001;
			touch-action: none;
			display: none;
			overflow: hidden;
			position: fixed;
			top: 150px;
			left: 150px;
			overflow-y: auto;
			transition: transform 0.95s ease, opacity 0.95s ease;
		}
		.modal-estadistico-cabecera {
			background: lightblue;
			color: #fff;
			padding: 8px 12px;
			cursor: grab;
			border-radius: 8px 8px 0 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			user-select: none;
		}
		.modal-estadistico-cuerpo {
			cursor: grab;
			padding: 10px;
			height: calc(100% - 40px);
			overflow-y: auto;
		}
		.modal-estadistico-acciones span {
			cursor: pointer;
			margin-left: 10px;
			font-weight: bold;
			font-size: 1.2em;
		}
		.resize-handle {
			position: absolute;
			width: 16px;
			height: 16px;
			right: 0;
			bottom: 0;
			cursor: se-resize;
			background: green;
			border-radius: 0 0 8px 0;
		}
		.modal-estadistico.minimized .modal-estadistico-cuerpo {
			display: none;
		}
		.content {
			flex: 1;
			padding: 10px;
			background: #fff;
			cursor: grab;
			overflow: auto;
		}
		.close-btn, .minimize-btn {
		cursor: pointer;
		margin-left: 10px;
		font-weight: bold;
		}	
		.open-button {
			position: absolute;
			top: 20px;
			left: 20px;
			z-index: 1100;
			padding: 10px 20px;
			background: #333;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}
		
		/*Modal Flash*/
		.modalflash {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 95vw;
			max-width: 700px;
			max-height: 90vh;
			background-color: yellow;
			border: 2px solid black;
			border-radius: 10px;
			display: flex;
			flex-direction: column;
			overflow: hidden;
			z-index: 99999;   /* MUY IMPORTANTE */
		}
		.modalflash-cabecera {
			background: red;
			color: white;
			padding: 12px;
			font-weight: bold;
			text-align: center;
			flex-shrink: 0;
		}
		.modalflash-cuerpo {
			padding: 15px;
			flex: 1;                /* OCUPA TODA LA ALTURA RESTANTE */
			overflow-y: auto;       /* SCROLL SI SE LLENA */
		}
		.modalflash-botones {
			display: flex;              /* CLAVE */
			justify-content: center;    /* centra horizontal */
			align-items: center;
			gap: 20px;                  /* espacio entre botones */
			margin-top: 15px;
		}

		/* estilos de botones */
		.modalflash-botones button {
			height: 30px;
			width: 90px;
			color: white;
			border-radius: 4px;
			cursor: pointer;
		}

		#btn-indicaciones-modal-flash {
			background-color: blue;
			color:white;
			border: 1px solid white;
			height:30px;
			width:90px;
			display: flex;
			align-items: center;      /* centra vertical */
			justify-content: center;  /* centra horizontal */
		}

		#btn-cerrar-modal-flash {
			background-color: red;
			color:white;
			border: 1px solid white;
			height:30px;
			width:90px;
			display: flex;
			align-items: center;      /* centra vertical */
			justify-content: center;  /* centra horizontal */
		}
		.modalflash-contador {
			display: flex;
			justify-content: center;   /* centra horizontal */
			align-items: center;
			margin-top: 10px;
			text-align: center;
		}
		
		/*Animaci√≥n inputs b√∫squedas Unidades//Sectores, servicios y personas*/
		.animated-input {
			padding: 15px 20px;
			font-size: 18px;
			border: 3px solid;
			border-radius: 10px;
			outline: none;
			background: linear-gradient(45deg, #ff0080, #ff8c00, #40e0d0, #ff0080);
			background-size: 400% 400%;
			color: white;
			transition: all 0.3s ease;
			animation: gradientAnimation 5s ease infinite, borderAnimation 5s ease infinite;
		}
		@keyframes gradientAnimation {
			0% { background-position: 0% 50%; }
			50% { background-position: 100% 50%; }
			100% { background-position: 0% 50%; }
		}
		@keyframes borderAnimation {
			0% { border-color: #ff0080; }
			25% { border-color: #ff8c00; }
			50% { border-color: #40e0d0; }
			75% { border-color: #00ff99; }
			100% { border-color: #ff0080; }
		}
		.animated-input.filled {
			background: black !important;
			color: #00ffff;
			border-color: #00ffff;
			animation: none;
		}
		
		/*Encabezados*/
		.fila {
			display: flex;
			flex-direction: row;
			width: 100%;
			height: 6vh; /* Fija alto al 6% del alto de pantalla */
			align-items: center;
			background-color: lightblue;
			padding-left: 80px; /* Separaci√≥n del borde */
		}
		.col-texto, .col-input {
			width: 75%;
			padding-right: 10px;
			display: flex;
			align-items: center;
			height: 100%;
		}
		.col-imagen {
			width: 25%;
			height: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.col-imagen img {
			max-height: 100%;
			max-width: 100%;
			object-fit: contain;
		}
		input[type="text"] {
			width: 80%;
			padding: 8px;
			font-size: 1em;
		}
		
		#distancia {
			position: absolute;
			top: 1px;
			left: 50%;
			transform: translateX(-50%);
			width: 80%;
			max-width: 580px;
			min-width: 280px;
			padding: 10px 14px;
			border-radius: 8px;
			text-align: center;
			font-size: 15px;
			font-weight: bold;
			background: #d4edda;
			color: #155724;
			box-shadow: 0 0 6px rgba(0,0,0,0.3);
			z-index: 999;
			display: none;
		}
		#distancia.visible {
			display: block;
		}

		.botonnorte {
			position: absolute;
			top: 15px;
			right: 80px;
			background: red;
			border: none;
			cursor: pointer;
			padding: 0;
			z-index:1030;
		}
		.botonnorte img {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			transition: transform 0.2s;
		}
		.botonnorte img:hover {
			transform: scale(1.5);
		}
		
		/*Flecha para destacar lo nuevo*/
		.flechaizquierdaroja {
			position: absolute;
			top: 48%;
			left: 3%;
			background: red;
			border: none;
			cursor: pointer;
			padding: 0;
			z-index:1030;
		}
		.flechaizquierdaroja img {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			transition: transform 0.2s;
		}
		
		.botoncentrado {
			position: absolute;
			top: 77px;
			right: 15px;
			background: none;
			border: none;
			cursor: pointer;
			padding: 0;
			z-index:1030;
		}
		.botoncentrado img {
			width: 35px;
			height: 35px;
			border-radius: 10px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			transition: transform 0.2s;
		}
		.botoncentrado img:hover {
			transform: scale(1.5);
		}
		
		.infomediciones {
			position: absolute;
			top: 10px;
			left: 50px;
			z-index: 1000;
			background: white;
			padding: 8px 10px;
			border-radius: 6px;
			box-shadow: 0 1px 4px rgba(0,0,0,0.3);
			font-family: sans-serif;
			min-width: 200px;
		}
		.btn {
			margin-top:8px;
			display:inline-block;
			padding:6px 8px;
			background:#2b7;
			color:white;
			border-radius:4px;
			cursor:pointer;
			text-align: center;
		}
		.btn.alt {
			background:#555;
		}
		
        @keyframes dash {
            to {
                stroke-dashoffset: 0;
            }
        }
		
		/*Configuraci√≥n adicional de la Barra Lateral para insertar Iconos Locales*/
		.sidebar-tabs1 > ul > li > a img {
			width: 32px !important;    /* tama√±o ideal */
			height: 32px !important;
			object-fit: contain !important;
			display: block !important;
			padding: 0 !important;
			margin: 0 auto !important;
		}
		#barralateral img {
			width: 40px;
			height: auto;
			vertical-align: middle;
			margin-right: 2px;
		}
		
		/*Configuraci√≥n de la Barra Lateral*/
		#barralateral {
			position: absolute;
			z-index: 550;
			max-width: 80%;
		}
		
		/*Estilo del Listbox para la Capa Base*/
		#listacapasbase {
			width: 220px;
			padding: 6px;
			font-size: 14px;
			border-radius: 6px;
			border: 1px solid #aaa;
			font-family: Arial, sans-serif;
			background: white;
		}
		
		/* Bot√≥n fijo abajo centrado Limpiar pantalla*/
		#BotonLimpiarPantalla{
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: #001a33;     /* azul oscuro */
			color: #00ffff;          /* celeste fl√∫or */
			font-size: 18px;
			font-weight: bold;
			padding: 14px 32px;
			border-radius: 30px;
			border: none;
			cursor: pointer;
			box-shadow: 0 0 15px rgba(0,255,255,0.7);
			z-index: 9999;
			animation: pulsobotonlimpiar 2s infinite ease-in-out;
		}
		/* Animaci√≥n autom√°tica Boton Limpiar Pantalla*/
		@keyframes pulsobotonlimpiar {
			0% {
				background-color: #001a33;
				transform: translateX(-50%) scale(1);
				box-shadow: 0 0 10px rgba(0,255,255,0.5);
			}
			50% {
				background-color: #004c99; /* azul m√°s claro */
				transform: translateX(-50%) scale(1.12);
				box-shadow: 0 0 26px rgba(0,255,255,1);
			}
			100% {
				background-color: #001a33;
				transform: translateX(-50%) scale(1);
				box-shadow: 0 0 10px rgba(0,255,255,0.5);
			}
		}
		
		/*Boton para desplegar detalles de rutas sugeridas*/
		#BotonDetallesRuta {
			position: fixed;
			top: 28%;
			right: 3%;
			z-index: 1050;
			background: #fff;
			color: white;
			border: 1px solid #777;
			border-radius: 6px;
			cursor: pointer;
			font-weight: bold;
			box-shadow: 0 2px 4px rgba(0,0,0,.3);
			animation: pulsobotonlimpiar 2s infinite ease-in-out;
		}
		
		#PanelRutas {
			position:fixed;
			top: 35%;
			right: 0;
			z-index:1050;
			display:none;           /* ‚Üê CLAVE */
			background:white;
			border-radius:6px;
			box-shadow:0 2px 6px rgba(0,0,0,.35);
		}
		
		/*Bloque para resaltar lo NUEVO*/
		/* Clase resaltado con animaci√≥n */
		.resaltarlonovedoso {
			animation: palpitar 1s infinite ease-in-out, cambiarColor 3s infinite ease-in-out;/*2s infinite alternate;*/
		}
		/* Palpitar (latido) */
		@keyframes palpitar {
			0%   { transform: scaleX(1); }
			50%  { transform: scaleX(1.5); }
			100% { transform: scaleX(1); }
		}
		/* Cambiar color entre dos tonos */
		@keyframes cambiarColor {
			0%   { background-color: #ff4d4d;}  /* rojo */
			33%  { background-color: #4dff4d;}  /* verde */
			66%  { background-color: #4d4dff;}  /* azul */
			100% { background-color: #ff4d4d;} 
		}
		
		/* el bot√≥n al que apunta la flecha */
		.area-ejemplo{display:flex;gap:20px;align-items:center}
		button{padding:10px 16px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
		.primario{background:green;color:#fff;border:none}

		/* capa y modal (tooltip grande) */
		.capa{position:fixed;inset:0;background:transparent;display:none;z-index:1500}
		.capa.active{display:block}

		/* gu√≠a/tooltip */
		.novedad{
		position:absolute;max-width:320px;padding:14px 16px;border-radius:10px;background:#a1d99b;box-shadow:0 8px 22px rgba(0,0,0,0.18);z-index:1000;cursor:pointer;transform-origin:center top;transition:transform .14s ease,opacity .12s ease;opacity:0;transform:translateY(-6px);color:green;
		}
		.novedad.show{opacity:1;transform:translateY(0)}

		/* flecha: apuntando hacia abajo (modal encima del bot√≥n) */
		.novedad::after{
		content:"";position:absolute;width:14px;height:14px;background:red;transform:rotate(45deg);left:50%;transform-origin:center;box-shadow:0 4px 8px rgba(0,0,0,0.08);
		/* se colocar√° con JS ajustando --arrow-x */
		top:100%;margin-left:calc(var(--arrow-x, -7px));
		}
		.novedad.oculto::after {
			content: none;
		}

		/* cuando el modal est√° debajo del bot√≥n, usamos la clase bottom y movemos la flecha arriba */
		.novedad.bottom::after{top:auto;bottom:100%;}

		/* texto dentro de la gu√≠a */
		.novedad h4{margin:0 0 6px 0;font-size:15px}
		.novedad p{margin:0;font-size:13px;color:#444}

		/* estilo peque√±o para indicar acci√≥n */
		.hint{margin-top:10px;font-size:12px;color:#666}
		@media (max-width: 600px) {
			.modalflash {
				width: 83vw;
				height: 75vh;
			}
			.fila {
				flex-wrap: nowrap;
			}
			.novedad{left:8px;right:8px;max-width:calc(100% - 16px)}
		}
    </style>
	<!--Icono para la pesta√±a del navegador-->
	<link rel="shortcut icon" href="./images/inta.ico" type="image/x-icon"/>
</head>

<!-- Barra de t√≠tulo -->
<div class="fila">
	<div class="col-texto" style="font-size:15px; color:blue;"><strong>MAPA WEB DEL INTA EEA MENDOZA</strong></div>
	<div class="col-imagen">
		<img src="./images/INTA.png" alt="Imagen 1">
	</div>
</div>

<!-- Barra de encabezado -->
<div class="fila">
	<div class="col-input">
		<input type="text" id="encontrar_a" class="animated-input" placeholder="¬øBusc√°s algo o alguien?..."/>
		<div id="sugerenciasbusqueda" class="sugerencias"></div>
	</div>
	<div class="col-imagen">
		<div id="ubicacion_texto" style="font-size:10px; text-align:right; background-color:lightblue; color:blue;width:80px"><strong>Mi ubicaci√≥n</strong><a id="ubicacion_estado" href="javascript:activar_seguimiento(seguimiento)"><img id="gps" src="./images/slide_off.jpg" width="50" height="30"></img></a></div>
	</div>
</div>
<body>
	<!--Ventana modal estad√≠sticas-->
	<dialog id="Modal_Grafico" style="text-align: center; background-color:#66FBA2">
		<p id="titulomodalgrafico"></p>
		<img id="imagenmodalgrafico" width="480" height="380" />
		<p id="subtitulomodalgrafico"></p>
		<div style="text-align: right">
			<button id="btn-cerrar-modal-grafico" style="height:30px; width:90px; background-color:red;border-color:white;color:white">Cerrar</button>
		</div>
	</dialog>

	<div id="mapa">
		<!--Barra Lateral-->
	<div id="barralateral" class="sidebar collapsed">
        <div class="sidebar-tabs sidebar-tabs1">
            <ul role="tablist">
                <li><a href="#home" role="tab"><img src="images/Home.jpg"></img></a></li>
				<li><a href="#mapita" role="tab"><img src="images/Lupa.png"></img></a></li>
				<li><a href="#unidades" role="tab"><img src="images/Mapear.png"></img></a></li>
				<li><a href="#herramientas" role="tab"><img src="images/Herramientas.png"></img></a></li>
				<li><a href="#ayuda" role="tab"><img src="images/Informacion.png"></img></a></li>
				<li><a href="#contacto" role="tab"><img src="images/Contacto.png"></img></a></li>
            </ul>
            <ul role="tablist">
				<li><a href="#logueo" role="tab"><img src="images/Usuario.png"></img></a></li>
            </ul>
        </div>

        <div class="sidebar-content"  style="background-color: rgba(255, 255, 255, 0.7);">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    BARRA DE OPCIONES
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
				<br></br>
				<p style="color:blue"><strong>¬øC√≥mo funciona cada herramienta de esta barra?</strong></p>
				<br></br>
				<p class="lorem"><img src="images/Lupa.png"></img>Te ayudar√° a encontrar un lugar o una persona</br>o una parcela en caso que seas parte del personal de la unidad</p>
				<br></br>
                <p class="lorem"><img src="images/Mapear.png"></img>Te ayudar√° a encontrar una Agencia de Extensi√≥n</br>u otra Experimental de Mendoza/San Juan</p>
				<br></br>
				<p class="lorem"><img src="images/Herramientas.png"></img>Te ofrecer√° algunas herramientas adicionales</br>tales como medidor de distancia y GPS</p>
				<br></br>
                <p class="lorem"><img src="images/Informacion.png"></img>Te dar√° detalles sobre c√≥mo usar cada herramienta</p>
				<br></br>
                <p class="lorem"><img src="images/Contacto.png"></img>Te posibilitar√° enviar un mail de consulta/sugerencia</p>
				<br></br>
				<p class="lorem"><img src="images/Usuario.png"></img>Acceso para usuarios registrados</p>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
				<br></br>
            </div>
            <div class="sidebar-pane" id="mapita">
                <h1 class="sidebar-header">Buscar...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p id="titulobuscarterritorio" class="lorem">Escrib√≠ o seleccion√° el lugar o la persona...</p>
				<input type="text" id="encontrar_abis" class="animated-input" placeholder="¬øBusc√°s algo o alguien?..." autocomplete="off"/>
				<div id="sugerenciasbusquedabis"></div>
				<br></br>
				<br></br>
				<p id="parrafoterritorio" style="color:blue">Escrib√≠ el nombre del lugar, el servicio, la persona o la especialidad que necesit√°s ubicar...</p>
				<br></br>
				<br></br>
				<p style="font-size:12px; color:blue" id="titulo_vid">¬øNecesit√°s filtrar por variedad de vid?. Hacelo desde aqu√≠...</p>
				<div id="opciones_cob" style="font-size:12px">
					<select id="cobertura_vid" onchange="CoberturasAbuscar(value)">
						<option value="" ></option>
						<option value="Ancelotta" >Ancelotta (tinta para vino)</option>
						<option value="Barbera Dasty" >Barbera D'Asty (tinta para vino)</option>
						<option value="Bonarda" >Bonarda (tinta para vino)</option>
						<option value="Cabernet Sauvignon">Cabernet Sauvignon (tinta para vino)</option>
						<option value="Chardonnay" >Chardonnay (blanca para vino)</option>
						<option value="Chenin" >Chenin (blanca para vino)</option>
						<option value="Malbec" >Malbec (tinta para vino)</option>
						<option value="Merlot" >Merlot (tinta para vino)</option>
						<option value="Pinot" >Pinot (tinta para vino)</option>
						<option value="Riesling" >Riesling (blanca para vino)</option>
						<option value="Semillon" >Semill√≥n (blanca para vino)</option>
						<option value="Syrah" >Syrah (tinta para vino)</option>
						<option value="Torrontes" >Torront√©s (blanca para vino)</option>
						<option value="Coleccion vinificacion" >Colecci√≥n de variedades p/vino</option>
						<option value="Coleccion varietal" >Colecci√≥n de varietales</option>
						<option value="Coleccion criollas" >Colecci√≥n de variedades criollas</option>
						<option value="Americanas" >Americanas</option>
						<option value="Portainjertos" >Portainjertos</option>
						<option value="Variedades de mesa" >Colecci√≥n de variedades p/mesa</option>
					</select>
				</div>
				<p style="font-size:12px; color:blue" id="titulo_otro_criterio"></br>¬øQuer√©s hacer la b√∫squeda con otro criterio diferente a Vid?. Hacelo desde aqu√≠...</p>
				<div id="opciones_otr" style="font-size:12px">
					<select id="otro_criterio" onchange="CriterioAbuscar(value)">
						<option value="" ></option>
						<option value="Cobertura">Tipo cobertura (cultivos/construc.)</option>
						<option value="Especie">Especie de cultivo</option>
						<option value="Conduccion">Conducci√≥n del cultivo</option>
						<option value="Riego">Tipo de riego</option>
						<option value="Clon">Clon plantado</option>
						<option value="Plantacion">A√±o de plantaci√≥n</option>
						<option value="Superficie">Seg√∫n superficie</option>
						<option value="Responsable">Responsable del ensayo</option>
					</select>
				</div>
				<div id="cobertura" style="font-size:12px">
					<select id="sel_cobertura" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Cultivo">Cultivos</option>
						<option value="Edificio">Edificios</option>
						<option value="Media Sombra">Media Sombra</option>
						<option value="Invernaculo">Invern√°culos</option>
						<option value="Estructura">Otros</option>
					</select>
				</div>
				<div id="especie" style="font-size:12px">
					<select id="sel_especie" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Vid">Vid</option>
						<option value="Cerezo">Cerezos</option>
						<option value="Huerta">Huerta Org√°nica</option>
						<option value="Inculto">Inculto</option>
						<option value="Hortalizas">Hortalizas</option>
						<option value="Tomate">Tomate</option>
						<option value="Flores">Flores</option>
						<option value="Hidroponia">Hidroponia</option>
					</select>
				</div>
				<div id="conduccion" style="font-size:12px">
					<select id="sel_conduccion" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Espaldero">Espaldero</option>
						<option value="Parral">Parral</option>
					</select>
				</div>
				<div id="riego" style="font-size:12px">
					<select id="sel_riego" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Goteo">Goteo</option>
						<option value="Superficial">Superficial</option>
					</select>
				</div>
				<div id="clon" style="font-size:12px">
					<select id="sel_clon" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="12">12</option>
						<option value="18">18</option>
						<option value="19">19</option>
					</select>
				</div>
				<div id="plantacion" style="font-size:12px">
					<select id="sel_plantacion" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Antes de 1990">Antes de 1990</option>
						<option value="Entre 1991 y 2000">Entre 1990 y 2000</option>
						<option value="Entre 2001 y 2010">Entre 2001 y 2010</option>
						<option value="Entre 2011 y 2020">Entre 2011 y 2020</option>
					</select>
				</div>
				<div id="superficie" style="font-size:12px">
					<select id="sel_superficie" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Menos de 0,1 ha">Menor a 0,1 ha</option>
						<option value="Entre 0,1 y 0,2 ha">Entre 0,1 y 0,2 ha</option>
						<option value="Entre 0,2 y 0,3 ha">Entre 0,2 y 0,3 ha</option>
						<option value="Entre 0,3 y 0,5 ha">Entre 0,3 y 0,5 ha</option>
						<option value="Entre 0,5 y 0,7 ha">Entre 0,5 y 0,7 ha</option>
						<option value="Entre 0,7 y 1 ha">Entre 0,7 y 1 ha</option>
						<option value="Entre 1 y 2 ha">Entre 1 y 2 ha</option>
						<option value="Entre 2 y 3 ha">Entre 2 y 3 ha</option>
						<option value="Mayor a 3 ha">Mayor a 3 ha</option>
					</select>
				</div>
				<div id="responsable" style="font-size:12px">
					<select id="sel_responsable" onchange="BuscarOtro(value)">
						<option value="" ></option>
						<option value="Ecofisiologia">Ecofisiolog√≠a</option>
						<option value="Claudia Lucero">Claudia Lucero</option>
						<option value="Gustavo Aliquo">Gustavo Aliquo</option>
						<option value="Santiago Sari">Santiago Sari</option>
						<option value="S. Gomez Talquenca">S. Gomez Talquenca</option>
						<option value="Rocio Torres">Roc√≠o Torres</option>
						<option value="Cooperadora">Cooperadora</option>
						<option value="German Aguado">Germ√°n Aguado</option>
						<option value="Gabriel Pisi">Gabriel Pisi</option>
						<option value="Virologia">Virolog√≠a</option>
						<option value="Viticultura">Viticultura</option>
						<option value="Juan C. Casciani">Juan C. Casciani</option>
					</select>
				</div>
				<button id="mostrartodo" type="button" style="background-color:green" onclick="MostrarTodo()">Mostrar todas las parcelas</button>
				<p><br></p>
				<button id="quitartodo" type="button" style="background-color:red" onclick="ResetearTodo()">Quitar todas las parcelas del mapa</button>
				<br>
				<br>
				<div id="cuadroestadisticasbarralateral" style="border: 2px ridge red; padding: 10px; text-align: center; background-color: lightblue">
					<p id="estadisticasbarralateral" style="color:blue;"><strong>* * Resumen Estad√≠stico * *</strong></p>
				</div>
            </div>
			<div class="sidebar-pane" id="unidades">				
				<h1 class="sidebar-header">Buscar en Mendoza y San Juan...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br>
				<p id="titulobuscarflia" class="lorem">Escrib√≠ o seleccion√° la AER √≥ EEA...</p>
				<input type="text" id="buscarunidad" class="animated-input" placeholder="AER o EEA..." autocomplete="off">
				<div id="sugerenciasunidad"></div>
				<br>
				<button id="volvereea" type="button" style="background-color:red" onclick="VolverEEA()">Volver al predio de la EEA Mendoza</button>
				<br>
				<p id="parrafofamilia" style="color:blue">Escrib√≠ alg√∫n dato que conozc√°s de la unidad que dese√°s ubicar y te centrar√° el mapa sobre ella.</p>
				<br>
            </div>
			<div class="sidebar-pane" id="herramientas">
                <h1 class="sidebar-header">Secci√≥n de herramientas...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br>
				<p class="lorem">Las herramientas disponibles son...</p>
				<br>
				<p id="reiniciar"><a href="javascript:ReiniciarPagina()"><img src="images/Reiniciar.png"></img></a>  <a href="javascript:ReiniciarPagina()" style="color: blue;">  Volver a empezar...</a></p>
				<p id="restablecernomostrar"><a href="#" onclick="RestablecerNoMostrar(); return false;" style="color:blue;">  Volver a mostrar mensajes informativos.</a> (Restablecer los mensajes informativos que puedas haber cancelado).</p>
				<p id="gpson"><a href="javascript:desactivar_seguimiento(seguimiento)"><img src="images/MiUbicacion.png"></img></a>  <a href="javascript:desactivar_seguimiento(seguimiento)" style="color: blue;">  Desactivar mi ubicaci√≥n actual</a></p>
				<p id="gpsoff"><a href="javascript:activar_seguimiento(seguimiento)"><img src="images/MiUbicacion.png"></img></a>  <a href="javascript:activar_seguimiento(seguimiento)" style="color: blue;">  Mi ubicaci√≥n actual</a></p>
				<p id="dondestoy"><a href="javascript:CentrarMiUbicacion()"><img src="images/MiUbicacion.png"></img></a>  <a href="javascript:CentrarMiUbicacion()" style="color: blue;">  Centrar en mi ubicaci√≥n actual</a></p>
				<p id="medir" style="color:blue;"><img src="images/Medir.png"></img>Medir distancias √≥ per√≠metros y superficie</p>
				<p style="color:blue; display:flex; align-items:center; gap:2px; margin:0;">
					Mapa de fondo:
					<select id="listacapasbase">
						<option value="osm">Open Street Maps</option>
						<option value="googlecallejero">Google Callejero</option>
						<option value="googlesatelite">Google Sat√©lite</option>
						<option value="openTopoMap">Open Topo Map</option>
						<option value="oscuro">Fondo Oscuro</option>
						<option value="ign">Inst. Geogr√°fico Nacional</option>
						<option value="igngris">Inst. Geogr√°fico Nacional (Gris)</option>
					</select>
				</p>
			</div>
			<div class="sidebar-pane" id="ayuda">
                <h1 class="sidebar-header">Secci√≥n de informaci√≥n de ayuda...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<br></br>
				<div id="ayuda_mapita">
					<p class="lorem"><img src="images/Lupa.png"></img> ¬øSos visitante y quer√©s ubicar algo o alguien?</br>En esta secci√≥n podr√°s buscar por nombre de edificio, servicio, especialidad o persona.</br>Si activ√°s tu GPS, podr√°s llegar mejor al lugar que busc√°s.</p>
					<p class="lorem">En caso que seas parte del personal de la unidad y hay√°s logueado, tambi√©n podr√°s acceder a la informaci√≥n de las parcelas bajo ensayo.</p>
					<br></br>
				</div>
				<div id="ayuda_unidades">
					<p class="lorem"><img src="images/Mapear.png"></img>¬øQuer√©s saber d√≥nde est√° y c√≥mo llegar a una Agencia de Extensi√≥n o Experimental de Mendoza √≥ San Juan?</br>En esta secci√≥n podr√°s buscarlas por nombre.</br>Si activ√°s tu GPS, podr√°s obtener una o dos rutas sugeridas para llegar.</p>
					<br></br>
				</div>
				
				<div id="ayuda_usuario">
					<p class="lorem"><img src="images/Herramientas.png"></img> En esta secci√≥n hallar√°s herramientas √∫ltiles, tales como activar tu ubicaci√≥n en tiempo real y medir una distancia o el per√≠metro y la superficie de una zona que vos indiqu√©s.</br></p>
					<br></br>
					<p class="lorem"><img src="images/Contacto.png"></img> Ponete en contacto con el desarrollador para hacerle saber de un error o una sugerencia de mejora.</br></p>
					<br></br>
					<p class="lorem"><img src="images/Usuario.png"></img> ¬øSos parte del personal de la unidad?<br></br>Logueate y acced√© a la informaci√≥n de cada parcela bajo ensayo.</p>
				</div>
				<br></br>
				<br></br>
				<div id="cantidadvisitas" style="color: blue;"></div>
				<br></br>
				<br></br>
            </div>
			<div class="sidebar-pane" id="contacto">
                <h1 class="sidebar-header">Secci√≥n de contacto con el desarrollador...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
				<br></br>
				<p>¬øEncontraste alg√∫n problema, ten√©s alguna sugerencia para mejorar este sitio o quer√©s solicitar acceso como usuario registrado?</p>
				<br></br>
				<p><a href="javascript:PrepararMail()"><img src="images/Contacto.png"></img></a><a href="javascript:PrepararMail()" style="color: blue;">  Por favor, comunicate con su desarrollador haciendo click aqu√≠...-</a></p>
            </div>
			
			<div class="sidebar-pane" id="logueo">
                <div id="log_no">
					<h1 class="sidebar-header">Por favor, ingrese sus datos...<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
					<p class="lorem" id="titulousuario">Usuario:</p>
					<input type="text" id="username" name="username" placeholder="Tu usuario de INTA (sin @inta.gob.ar)..." value="">
					<p class="lorem" id="titulocontrasenia">Contrase√±a:</p>
					<input type="password" id="password" name="password" placeholder="Tu contrase√±a para este sitio..." value="">
					<input type="submit" id="botonmostrarocultar" value="Mostrar/Ocultar" onclick="Contrasenia();">
					<br><br>
					<input type="submit" style="background-color:#acf89f" id="botoningresar" value="Ingresar" onclick="Loguearse();">
				</div>
				<div id="log_si">
					<br></br>
					<input id="cerrarsesion" type="submit" style="background-color:#f48d8d" value="Cerrar sesi√≥n" onclick="CerrarSesion();"></input>
				</div>
            </div>
        </div>
    </div>
		<div id="distancia">Buscando ubicaci√≥n...</div>
		<button id="BotonLimpiarPantalla" onclick="LimpiarPantalla()">üßπ Despejar pantalla</button>
		<button id="BotonDetallesRuta">Detalles Ruta</button>
		<div id="PanelRutas"></div>
		<button class="botonnorte" id="botonnorte">
			<img src="./images/norte.jpg" alt="Norte del Mapa" title="Norte terrestre">
		</button>
		<button class="botoncentrado" id="botoncentrado" onclick="CentrarMiUbicacion()" title="Centrar en mi ubicaci√≥n real">
			<img src="./images/posicion.png" alt="Centrar en Mi Ubicaci√≥n">
		</button>
		<div class="infomediciones" id="contenedorMediciones">
			<div id="modoActual"><strong>Modo:</strong> Superficie</div>
			<div id="resultado1">Superficie total: ‚Äî</div>
			<div id="resultado2">Distancia total: -</div>
			<div class="btn" id="cambiarMedicion">Cambiar a Distancia</div>
			<div class="btn alt" id="limpiarMedicion" onclick="ResetearMediciones()">Limpiar</div>
		</div>
		<button class="flechaizquierdaroja" id="flecharoja">
			<img src="./images/flecha_izquierda_roja.png"><img src="./images/flecha_izquierda_roja.png">
		</button>
	</div>
	
	<!-- la gu√≠a/modal con flecha (se posiciona con JS) -->
	<div id="cartelnuevo" class="novedad" role="dialog" aria-modal="true" style="display:none">
		<p style="color:green";>Las herramientas que estaban en la pantalla,</p>
		<p style="color:green";>ahora est√°n ordenadas dentro de esta barra.</p>
		<p style="color:green";>As√≠, tendr√°s m√°s espacio para ver mejor el mapa.</p>
		<br></br>
		<label id="borrablelonuevo" style="display: flex; justify-content: center; align-items: center;	gap: 6px;">
			<input id="nomostrarlonuevo" type="checkbox" style="width:16px; height:16px;"/>
			No volver a mostrar
		</label>
	</div>
</body>

<div class="modalflash" id="MiModalFlash">
	<div class="modalflash-cabecera" id="titulomodalflash">¬°¬°¬° BIENVENIDO AL VISOR WEB DEL INTA EEA MENDOZA...!!!</div>
	<p class="modalflash-cuerpo" id="cuerpomodalflash"><img src="./images/presentacion.jpg" style="display: block; margin: auto; height:80px" id="imagenmodalflash"/><br><strong>Si sos un visitante, este mapa en l√≠nea te permitir√°:</strong>
		<br>* Ubicar una persona, servicio, especialidad o lugar
		<br>* Encontrar alguna otra unidad del INTA en la zona con una o dos rutas recomendadas
		<br> (Estas dos herramientas con la opci√≥n de hacerlo a partir de tu ubicaci√≥n en tiempo real)
		<br>* Acceder a algunas herramientas geogr√°ficas como medir distancias, per√≠metros y superficies, etc.
		<br><strong>Si trabaj√°s en INTA, adem√°s podr√°s:</strong>
		<br>* Realizar consultas sobre las parcelas y las construcciones de la Experimental Mendoza.
		<br><strong>En la barra lateral podr√°s encontrar secciones con las herramientas disponibles y un apartado de ayuda para encontrarlas y saber su funci√≥n.-</strong>
		<div id="visitas" style="color: blue;"></div>
		<div style="text-align: center">
			<label id="borrableinicial">
				<input id="nomostrarinicial" type="checkbox" style="width:16px; height:16px;"/>
				No volver a mostrar
			</label>
			<div class="modalflash-botones" id="botonesModalFlash">
				<button id="btn-indicaciones-modal-flash" onclick="IniciarRuteo()">S√≠</button>
				<button id="btn-cerrar-modal-flash">Cerrar</button>
			</div>
		</div>
		<div class="modalflash-contador">
			<span style="font-weight: bold; color:red; text-align: center;">Me cierro en: <span id="contador"> </span> segundos</span>
		</div>
	</p>
</div>

<!--Ventana modal inicial-->
<dialog id="modal_inicial" style="text-align: center; background-color:yellow; font-size:13px;">
	<div id="Apaisado">
		<span id="titulo_modalinicial"><h4>Parece que est√°s usando un dispositivo movil (celular o tablet).</h4></span>
		<br><br/>
		<span id="cuerpo_modalinicial"><h4>En caso que no veas los mensajes completos o todas las herramientas,<br/>prob√° de girar la pantalla. Eso har√° que tengas una mejor visi√≥n del mapa y sus herramientas.-</h4>
		<br/>Record√° que en todo momento dispon√©s de distintas herramientas sobre la barra lateral izquierda.<br/>¬øQuer√©s saber c√≥mo funcionan? Toc√° las tres l√≠neas de su parte superior y recibir√°s ayuda.</span>
	</div>
	<div id="Conectividad">
		<span id="titulo_modalconectividad"><h4>Parece que no ten√©s conexi√≥n a Internet.</h4></span>
		<span id="cuerpo_modalconectividad"><h2><br/>Por favor solucion√° eso porque algunas herramientas no funcionar√°n correctamente.</h2></span>
	</div>
	<div style="text-align: right">
		<label id="borrablecelular">
			<input id="nomostrarcelular" type="checkbox" style="width:16px; height:16px;"/>
			No volver a mostrar
		</label>
		<button id="btn-cerrar-modal-inicial" style="height:30px; width:90px; background-color:red;border-color:white;color:white">Cerrar</button>
	</div>
</dialog>

<div class="modal-estadistico" id="modalestadistico">
	<div class="modal-estadistico-cabecera" id="modalestadisticocabecera">
		<span id="titulomodalestadistico">Resumen estad√≠stico</span>
		<div class="modal-estadistico-acciones">
			<span class="minimize-btn" onclick="MinimizarModalEstadistico()">üóï</span>
			<span onclick="CerrarModal()">‚úñ</span>
		</div>
	</div>
	<div class="modal-estadistico-cuerpo" id="modalestadisticocuerpo">
		<p id="cuerpomodalestadistico">
		</p>
	</div>
	<div class="resize-handle" id="resizeHandle">‚á≤</div>
</div>

<script>
	var Version = "1"; //Cambiar este valor para volver a mostrar el modal de presentacion cada vez que haya una actualizacion importante
	<!--Mapas o capas bases-->
	var ign = new L.tileLayer('https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{-y}.png', {
		attribution: 'Teselas <a href="https://www.ign.gob.ar/" target="_blank">IGN</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a> |Versi√≥n: '+Version,
		}
	);

	var igngris=new L.tileLayer('https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/mapabase_gris@EPSG%3A3857@png/{z}/{x}/{-y}.png', {
		attribution: 'Teselas <a href="https://www.ign.gob.ar/" target="_blank">IGN</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: '+Version,
		}
	);

	var osm = new L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		attribution: 'Teselas <a href="https://www.openstreetmap.org/" target="_blank">OSM</a> &copy; ' +
        '<a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: ' + Version
	});
	var googlesatelite = new L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
		attribution: 'Teselas <a href="https://www.google.com.ar/maps/@-21.5405995,-63.9542602,11544855m/data=!3m1!1e3?entry=ttu" target="_blank">Google Satelital</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: '+Version,
		}
	);
	var googlecallejero=new L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
		attribution: 'Teselas <a href="https://www.google.com/maps/d/viewer?mid=1pFMZyH1aut3nTDdgkw2U9c3jtxY&hl=en_US&ll=-40.429460336394065%2C-63.6166725&z=4/" target="_blank">Google Maps</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: '+Version,
		}
	);
	var oscuro = new L.tileLayer('http://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {
		attribution: 'Teselas <a href="https://carto.com/about-carto/" target="_blank">Carto</a> &copy; <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: '+Version,
		}
	);
	var openTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
		attribution: 'Map data: ¬© OpenStreetMap contributors, SRTM | Map style: ¬© OpenTopoMap (CC-BY-SA); <a href="javascript:PrepararMail()">Desarrollado por: Mauricio Godoy</a>|Versi√≥n: '+Version,
		});

	<!--Selector de las capas base-->
	var capasBase = {
		osm,
		googlecallejero,
		googlesatelite,
		openTopoMap,
		oscuro,
		ign,
		igngris
	};

	<!--Establecer el √°rea para el mapa y definir cu√°l ser√° la capa base por defecto-->
	var mapa = L.map('mapa', {editable:true,
		center: ["-33.00598405638592", "-68.85600484779212"],
		zoom: 16,
		maxZoom: 18,
		zoomControl: false,
		layers: [osm],
		zoomControl:false
	});

	//L.control.layers(CapasBase).addTo(mapa);
	
	L.control.zoom({
		position:'topright'}).addTo(mapa);
	<!--A√±adir el mini-mapa al lienzo-->
	var minimapamundial = L.control.worldMiniMap({position: 'bottomright', style: {opacity: 0.9, borderRadius: '0px', backgroundColor: 'lightblue'}}).addTo(mapa);

	<!--Defino las variables globales-->
	var capa_filtrada={};
	var capa_buscar={};
	var capa_buscar1={};
	var capa=osm;
	var sup_total=0;
	var tot_parc=0;
	var prom_prod=0;
	var anios_prod=0;
	var coordenadas="-33.00598405638592, -68.85600484779212".split(",");
	var zum=16;
	var capturaActiva= false;
	var firstLatLng, secondLatLng;
	var conexion="";
	var intervaloRuta = "";
	var seguimiento="no";
	var listabusqueda=[];
	var listabusquedafiltrada=[];
	var capa_parcelas=[];
	var sector="";
	var coincidencia="";
	var persona="";
	var oficina="";
	var lugar="";
	var marca_ubicacion_real="";
	var coordenadas_ubicacion_real="";
	var sondeo_posicion="";
	var aer="";
	var mail="";
	var version="publica";
	var tiempomodalflash=20000;
	var temporizadormodalflash=null;
	var intervalo=null;
	var tiempo=null;
	var dentroeeamza="";
	var dispositivo="";
	var coord=[];
	var markers=[];
	var perimetro=null;
	var superficie=null;
	var puntos = [];
	var distanciaTotal = 0;
	var modo = "superficie";
	var cant_mediciones=0;
	var centroide=L.latLng(-33.00376868173891, -68.85766030976325);
	var entradaeea=L.latLng(-33.003773232329486, -68.85766687268227);
	var poligono="";
	var ruta="";
	var senialgps="";
	var orientarme="";
	var avisollegada="";
	var msgencontrado="";
	var icono_posicion = L.icon({iconUrl: './images/posicion.png',iconSize: [35, 40],});
	var icono_inta= L.icon({iconUrl: './images/inta.jpg',iconSize: [30, 30],});
	var distancia="";
	var actualizarruta="si";
	var iraaer="";
	var titulomodalflash=document.getElementById("titulomodalflash");
	var cuerpomodalflash=document.getElementById("cuerpomodalflash");
	var aers=["Agencia de Extensi√≥n Guaymall√©n","Agencia de Extensi√≥n Jun√≠n","Agencia de Extensi√≥n Lavalle","Agencia de Extensi√≥n La Consulta","Agencia de Extensi√≥n Luj√°n de Cuyo","Agencia de Extensi√≥n Maip√∫","Oficina de Informaci√≥n Uspallata","Experimental Jun√≠n","Experimental La Consulta","Experimental Rama Ca√≠da","Experimental San Juan"];
	var grupoeeamza = L.featureGroup().addTo(mapa);
	
	//A√±ado el predio de la EEA Mendoza
	var predioeeamza=L.geoJSON(inta,{style: PerimetroEEAMza}).addTo(grupoeeamza);
	var marcadoreeamzaoeste = L.marker([-33.00451232201417, -68.8614969142567], {icon: icono_inta}).addTo(grupoeeamza);
	var marcadoreeamzaeste = L.marker([-33.006887629673, -68.85250615069111], {icon: icono_inta}).addTo(grupoeeamza);
	
	<!--A√±adir la barra lateral-->
	var barralateral = L.control.sidebar('barralateral').addTo(mapa);
	
	//Capturar evento sobre botones
	const btncerrarmodalflash=document.querySelector("#btn-cerrar-modal-flash");
	const btnindicacionesmodalflash=document.querySelector("#btn-indicaciones-modal-flash");
	const cajadistancia = document.getElementById("distancia");
	const btncerrarmodalinicial=document.querySelector("#btn-cerrar-modal-inicial");
	const modalinicial=document.querySelector("#modal_inicial");
	const mimodalflash=document.querySelector("#MiModalFlash");
	const nomostrarinicial = document.getElementById('nomostrarinicial');
	const nomostrarcelular = document.getElementById('nomostrarcelular');
	const nomostrarlonuevo = document.getElementById('nomostrarlonuevo');
	const botondetallesruta =document.getElementById("BotonDetallesRuta");
	const visitas=document.getElementById("visitas");
	const cantidadvisitas=document.getElementById("cantidadvisitas");
	const botoncentrado=document.getElementById("botoncentrado");
	const panelrutas=document.getElementById("PanelRutas");
	let refrescoRutaActivo = false;
	
	//Estilizar el per√≠metro de la EEA Mza
	function PerimetroEEAMza(feature) {
      return {
        color: "red",
        weight: 3,
        fillColor: "green",
        fillOpacity: 0.4
      };
    };
	
	<!--Funcion para colorear el fondo seg√∫n el tipo de coberura (cultivos/edificios)-->
	function ColorFondo(d) {
		return d == 'Cultivo' ? '#0aa621':
			'#0b08a1'};

	<!--Funcion para colorear per√≠metro cultivos/edificios-->
	function ColorPerimetro(d) {
		return d=='Cultivo' ? 'white':
			'black'};

	<!--Funcion para llamar subfunciones de coloreo per√≠metros y √°reas-->
	function PersonalizarPerimetro(feature) {
		return {
		fillColor: ColorFondo(feature.properties.Cobertura),
		weight: 4,
		opacity: 1,
		color: ColorPerimetro(feature.properties.Cobertura),
		dashArray: '3',
		fillOpacity: 0.3}};
		
	function PersonalizarBusquedas(feature) {
		return {
		fillColor: 'red',
		weight: 4,
		opacity: 1,
		color: 'blue',
		dashArray: '3',
		fillOpacity: 0.8}};

	function ReiniciarPagina () {
		location.reload();
	};
	
	<!--Funci√≥n para preparar todos los Pop-ups-->
	function onEachFeature(feature, layer) {
		if (encontrar_a.value=="") {
		sup_total=sup_total+feature.properties.Sup_Croqui;
		tot_parc=tot_parc+1;
		<!--Calcular el promedio general-->
		prom_prod=prom_prod+feature.properties.Prod_2017+feature.properties.Prod_2018+feature.properties.Prod_2019+feature.properties.Prod_2020+feature.properties.Prod_2021;
		<!--Calcular los a√±os con producci√≥n (se excluyen los que no tienen datos)-->
		if (feature.properties.Prod_2017 !=null) {anios_prod=anios_prod+1};
		if (feature.properties.Prod_2018 !=null) {anios_prod=anios_prod+1};
		if (feature.properties.Prod_2019 !=null) {anios_prod=anios_prod+1};
		if (feature.properties.Prod_2020 !=null) {anios_prod=anios_prod+1};
		if (feature.properties.Prod_2021 !=null) {anios_prod=anios_prod+1};
		<!--Establecer el mini-logo del PopUp de acuerdo al cultivo/uso de la parcela-->
		if (feature.properties.Variedad=="Ancelotta" || feature.properties.Variedad=="Barbera Dasty" || feature.properties.Variedad=="Bonarda" || feature.properties.Variedad=="Cabernet"
			|| feature.properties.Variedad=="Malbec" || feature.properties.Variedad=="Merlot" || feature.properties.Variedad=="Pinot" || feature.properties.Variedad=="Syrah"
			|| feature.properties.Variedad=="Cabernet Sauvignon") {logo='./images/Uvas_Tintas.jpg'};
		if (feature.properties.Variedad=="Chardonnay" || feature.properties.Variedad=="Chenin" || feature.properties.Variedad=="Riesling" || feature.properties.Variedad=="Sauvignon"
			|| feature.properties.Variedad=="Semillon" || feature.properties.Variedad=="Torrontes") {logo='./images/Uvas_Blancas.jpg'};
		if (feature.properties.Variedad=="Variedades de mesa" || feature.properties.Variedad=="Coleccion vinificacion" || feature.properties.Variedad=="Coleccion varietal"
			|| feature.properties.Variedad=="Coleccion criollas" || feature.properties.Variedad=="Americanas" || feature.properties.Variedad=="Portainjertos") {logo='./images/Mezcla.jpg'};
		if (feature.properties.Especie=="Huerta" || feature.properties.Especie=="Hortalizas" ) {logo='./images/Hortalizas.png'};
		if (feature.properties.Especie=="Cerezo") {logo='./images/Cerezos.jpg'};
		if (feature.properties.Especie=="Flores") {logo='./images/Flores.jpg'};
		if (feature.properties.Especie=="Hidroponia") {logo='./images/Hidroponia.jpg'};
		if (feature.properties.Cobertura=="Invernaculo") {logo='./images/Invernaculos.jpg'};
		if (feature.properties.Cobertura=="Edificio" || feature.properties.Cobertura=="Estructura") {logo='./images/Edificios.jpg'};
		if (feature.properties.Especie=="Inculto") {logo='./images/Inculto.jpg'};
		var formatoPopup = {
			'maxWidth': '200',
			'className' : 'popups'}
		<!--Reconocer las parcelas que tienen o no informaci√≥n sobre producci√≥n-->
		if (feature.properties.id==2 || feature.properties.id==4 || feature.properties.id==8 || feature.properties.id==9 || feature.properties.id==10 || feature.properties.id==11
			|| feature.properties.id==19 || feature.properties.id==27 || feature.properties.id==28 || feature.properties.id==29 || feature.properties.id==31 || feature.properties.id==33
			|| feature.properties.id==37 || feature.properties.id==38 || feature.properties.id==42 || feature.properties.id==46 || feature.properties.id==50 || feature.properties.id>59 && feature.properties.id<95
			|| feature.properties.id==391 || feature.properties.id==392 || feature.properties.id==401) {
				grafico="SinInfo.jpg"}
		else {
			grafico=feature.properties.id+".jpg"};
		if (feature.properties.Cobertura=="Cultivo" && grafico !="SinInfo.jpg") {
			if (feature.properties.Responsabl ==null) {respon="Sin informaci√≥n"};
			if (feature.properties.Plantacion ==null) {planta="Sin informaci√≥n"};
			if (feature.properties.Conduccion ==null) {conduc="Sin informaci√≥n"};
			if (feature.properties.Variedad ==null) {varied="Sin informaci√≥n"};
			if (feature.properties.Responsabl !=null) {respon=feature.properties.Responsabl};
			if (feature.properties.Plantacion !=null) {planta=feature.properties.Plantacion};
			if (feature.properties.Conduccion !=null) {conduc=feature.properties.Conduccion};
			if (feature.properties.Variedad !=null) {varied=feature.properties.Variedad};
			var id_parcela=feature.properties.id;
			var variedad_parcela=feature.properties.Variedad;
			if (feature.properties.Responsabl !=null) {var responsable_parcela=feature.properties.Responsabl};
			if (feature.properties.Responsabl ==null) {var responsable_parcela="Sin Informaci√≥n"};
			<!--PopUp a mostrar SI: La parcela tiene un cultivo y tiene datos de producci√≥n-->
			var contenidoPopup="<b><h4>Especie: "+feature.properties.Especie+"   "+"<img src="+logo+" width='35' height='35' /img>"+"</b></h4><br/>Variedad: "+varied+"<br/>Conducci√≥n: "+conduc+
				"<br/>A√±o de plantaci√≥n: "+planta+"<br/>Hileras: "+feature.properties.Hileras+"<br/>Superficie: "+feature.properties.Sup_Croqui+" ha"+"<br/>Responsable: "+respon+
				"<br/><p style='cursor: pointer; color:#0000ff' onclick='return Funcion_Modal(\""+id_parcela+"\", \""+variedad_parcela+"\", \""+responsable_parcela+
				"\", 545, 433)'><u>Ver Gr√°fico de Estad√≠sticas...</u></p>"};
		if (feature.properties.Cobertura=="Cultivo" && grafico =="SinInfo.jpg") {
			if (feature.properties.Responsabl ==null) {respon="Sin informaci√≥n"};
			if (feature.properties.Plantacion ==null) {planta="Sin informaci√≥n"};
			if (feature.properties.Conduccion ==null) {conduc="Sin informaci√≥n"};
			if (feature.properties.Variedad ==null) {varied="Sin informaci√≥n"};
			if (feature.properties.Responsabl !=null) {respon=feature.properties.Responsabl};
			if (feature.properties.Plantacion !=null) {planta=feature.properties.Plantacion};
			if (feature.properties.Conduccion !=null) {conduc=feature.properties.Conduccion};
			if (feature.properties.Variedad !=null) {varied=feature.properties.Variedad};
			<!--PopUp a mostrar SI: La parcela tiene un cultivo y no tiene datos de producci√≥n-->
			var contenidoPopup="<b><h4>Especie: "+feature.properties.Especie+"   "+"<img src="+logo+" width='35' height='35' /img>"+"</b></h4><br/>Variedad: "+varied+"<br/>Conducci√≥n: "+conduc+
				"<br/>A√±o de plantaci√≥n: "+planta+"<br/>Hileras: "+feature.properties.Hileras+"<br/>Superficie: "+feature.properties.Sup_Croqui+" ha"+"<br/>Responsable: "+respon};
		if (feature.properties.Cobertura !="Cultivo") {
			<!--PopUp a mostrar SI: La parcela no tiene cultivo-->
			var contenidoPopup="Cobertura: "+feature.properties.Cobertura+"   "+"<img src="+logo+" width='35' height='35' /img>"+"<br/>Descripci√≥n: "+feature.properties.Descripcio+
				"<br/>Superficie: "+feature.properties.Sup_Croqui+" ha"};
		layer.bindPopup(contenidoPopup, formatoPopup);
		mapa.flyTo(coordenadas, zum)}
		else {if (feature.properties.Descripcio==sector) {
			coord_sector=(feature.geometry.coordinates[0][1]+", "+feature.geometry.coordinates[0][0]).split(",");
			centroide=layer.getBounds().getCenter();
			coord=[];
			coord.push(centroide.lat,centroide.lng);
			mapa.flyTo(coord, 16);
			poligono=feature.geometry.coordinates[0];
			if (coincidencia=="sector") {var contenidoPopup="<p>Si est√°s buscando a:</p>"+"<h4><strong><p style='color:blue'>"+inputbusqueda.value
			+"</p></h4></b></strong>Lo encontrar√°s en este edificio que lleva ese mismo nombre.";msgencontrado="Este sector se llama "+inputbusqueda.value;};
			if (coincidencia =="actividad") {var contenidoPopup="<p>Si est√°s buscando a:</p>"+"<h4><strong><p style='color:blue'>"+inputbusqueda.value
			+"</p></h4></b></strong>Lo encontrar√°s en este edificio, llamado: "+"<h4><strong><p style='color:blue'>"+sector+"</h4></p></strong>";msgencontrado="En este sector llamado "+sector+"se trabaja con "+inputbusqueda.value;};
			if (coincidencia =="persona" && oficina=="") {var contenidoPopup="<p>Si est√°s buscando a:</p>"+"<h4><strong><p style='color:blue'>"+inputbusqueda.value
			+"</p></h4></b></strong>Lo encontrar√°s en este edificio, llamado: "+"<h4><strong><p style='color:blue'>"+sector+"</h4></p></strong>";msgencontrado="En este sector llamado "+sector+"encontrar√°s a "+inputbusqueda.value;};
			if (coincidencia =="persona" && oficina !=="") {var contenidoPopup="<p>Si est√°s buscando a:</p>"
			+"<h4><strong><p style='color:blue'>"+inputbusqueda.value+"</p></h4></b></strong>Lo encontrar√°s en este edificio, llamado: "+"<h4><strong><p style='color:blue'>"+sector+"</h4></p></strong>"
			+"<p>Te recomendamos preguntar por la Oficina o el Laboratorio de: "+"<h4><strong><p style='color:blue'>"+oficina+"</h4></p></strong>";msgencontrado="En este sector llamado "+sector+"encontrar√°s a "+inputbusqueda.value+"pregunt√° por la oficina de "+oficina;};
			if (coincidencia=="especialidad") {var contenidoPopup="<p>Si est√°s buscando a:</p>"+"<h4><strong><p style='color:blue'>"+inputbusqueda.value
			+"</p></h4></b></strong>Lo encontrar√°s en este edificio, llamado: "+"<h4><strong><p style='color:blue'>"+sector+"</h4></p></strong>"+
			"<p>Te recomendamos preguntar por: "+"<h4><strong><p style='color:blue'>"+persona+"</p></strong></h4>";msgencontrado="En este sector llamado "+sector+"encontrar√°s a "+inputbusqueda.value+"te recomiendo preguntar por "+persona;};
			lugar=L.marker(coord).addTo(mapa)
						.bindPopup(contenidoPopup, formatoPopup)
						.openPopup()};
		};
		
	};

	<!--Funcion para filtrar con criterio distinto a vid. Es insensible al uso de may√∫sculas/min√∫sculas y busca con criterio tipo "*...*" -->
	function CriterioAbuscar(valor) {
		encontrar_a.value = "";
		encontrar_a.placeholder = "¬øBusc√°s algo o alguien?...";
		cobertura_vid.value="";
		criterio=valor;
		document.getElementById("responsable").style.visibility='hidden';
		document.getElementById("conduccion").style.visibility='hidden';
		document.getElementById("riego").style.visibility='hidden';
		document.getElementById("clon").style.visibility='hidden';
		document.getElementById("superficie").style.visibility='hidden';
		document.getElementById("plantacion").style.visibility='hidden';
		document.getElementById("cobertura").style.visibility='hidden';
		document.getElementById("especie").style.visibility='hidden';
		document.getElementById("quitartodo").style.visibility='hidden';
		document.getElementById("mostrartodo").style.visibility='hidden';
		document.getElementById("sel_clon").style.visibility='hidden';
		document.getElementById("sel_cobertura").style.visibility='hidden';
		document.getElementById("sel_conduccion").style.visibility='hidden';
		document.getElementById("sel_especie").style.visibility='hidden';
		document.getElementById("sel_plantacion").style.visibility='hidden';
		document.getElementById("sel_responsable").style.visibility='hidden';
		document.getElementById("sel_riego").style.visibility='hidden';
		document.getElementById("sel_superficie").style.visibility='hidden';
		document.getElementById("sel_clon").value="";
		document.getElementById("sel_cobertura").value="";
		document.getElementById("sel_conduccion").value="";
		document.getElementById("sel_especie").value="";
		document.getElementById("sel_plantacion").value="";
		document.getElementById("sel_responsable").value="";
		document.getElementById("sel_riego").value="";
		document.getElementById("sel_superficie").value="";
		if (otro_criterio.value=="Responsable") {
			document.getElementById("responsable").style.visibility='visible';
			document.getElementById("sel_responsable").style.visibility='visible'};
		if (otro_criterio.value=="Clon") {
			document.getElementById("clon").style.visibility='visible';
			document.getElementById("sel_clon").style.visibility='visible'};
		if (otro_criterio.value=="Superficie") {
			document.getElementById("superficie").style.visibility='visible';
			document.getElementById("sel_superficie").style.visibility='visible'};
		if (otro_criterio.value=="Riego") {
			document.getElementById("riego").style.visibility='visible';
			document.getElementById("sel_riego").style.visibility='visible'};
		if (otro_criterio.value=="Plantacion") {
			document.getElementById("plantacion").style.visibility='visible';
			document.getElementById("sel_plantacion").style.visibility='visible'};
		if (otro_criterio.value=="Conduccion") {
			document.getElementById("conduccion").style.visibility='visible';
			document.getElementById("sel_conduccion").style.visibility='visible'};
		if (otro_criterio.value=="Cobertura") {
			document.getElementById("cobertura").style.visibility='visible';
			document.getElementById("sel_cobertura").style.visibility='visible'};
		if (otro_criterio.value=="Especie") {
			document.getElementById("especie").style.visibility='visible';
			document.getElementById("sel_especie").style.visibility='visible'};
		document.getElementById("quitartodo").style.visibility='visible';
		document.getElementById("mostrartodo").style.visibility='visible';
	};

	<!--Funcion para filtrar con otro criterio distinto a vid-->
	function CoberturasAbuscar(valor) {
		encontrar_a.value = "";
		encontrar_a.placeholder = "¬øBusc√°s algo o alguien?...";
		sup_total=0;
		tot_parc=0;
		prom_prod=0;
		anios_prod=0;
		document.getElementById("responsable").style.visibility='hidden';
		document.getElementById("conduccion").style.visibility='hidden';
		document.getElementById("riego").style.visibility='hidden';
		document.getElementById("clon").style.visibility='hidden';
		document.getElementById("superficie").style.visibility='hidden';
		document.getElementById("plantacion").style.visibility='hidden';
		document.getElementById("cobertura").style.visibility='hidden';
		document.getElementById("especie").style.visibility='hidden';
		modal.style.visibility='hidden';
		document.getElementById("otro_criterio").value="";
		if (Object.keys(capa_filtrada).length !== 0) {capa_filtrada.remove()};
		if (Object.keys(capa_buscar).length !==0) {capa_buscar.remove()};
		if (Object.keys(capa_buscar1).length !==0) {capa_buscar1.remove()};
		if (lugar !==""){lugar.remove()};
		if (grupoeeamza) {mapa.removeLayer(grupoeeamza)};
		capa_filtrada=L.geoJSON(parcelas,{filter:Filtrar_Vid, style: PersonalizarPerimetro, onEachFeature}).addTo(mapa);
		document.getElementById("quitartodo").style.visibility='visible';
		document.getElementById("mostrartodo").style.visibility='visible';
	};

	<!--Funcion para filtrar parcelas con valores distintos a vid-->
	function BuscarOtro(valor) {
		encontrar_a.value = "";
		encontrar_a.placeholder = "¬øBusc√°s algo o alguien?...";
		sup_total=0;
		tot_parc=0;
		prom_prod=0;
		anios_prod=0;
		if (Object.keys(capa_filtrada).length !== 0) {capa_filtrada.remove()};
		if (Object.keys(capa_buscar).length !==0) {capa_buscar.remove()};
		if (Object.keys(capa_buscar1).length !==0) {capa_buscar1.remove()};
		capa_filtrada=L.geoJSON(parcelas,{filter:Filtrar_Gral, style: PersonalizarPerimetro, onEachFeature}).addTo(mapa);
		var resumen='<span>Criterio de filtro: <span style=color:blue><strong>'+criterio+" - "+valor+'</strong>.</span><br><span>Cantidad de parcelas: <span style=color:blue><strong>'+tot_parc+
			'</strong>.</span></span><br><span>Superficie: <span style=color:blue><strong>'+sup_total.toFixed(2)+'</strong>.</span></span><br><span>Promedio de Producci√≥n Anual: <span style=color:blue><strong>'+
			(prom_prod/anios_prod/sup_total).toFixed(2)+" qq/ha"+'</strong>.</span></span>';
		document.getElementById("cuadroestadisticasbarralateral").style.visibility='visible';
		modal.style.visibility='visible';
		document.getElementById("estadisticasbarralateral").innerHTML=resumen;
		if (anios_prod !==0) {document.getElementById("titulomodalestadistico").innerText=("Resumen Estad√≠stico"); document.getElementById("cuerpomodalestadistico").innerHTML=resumen;AbrirModalEstadistico()};
		if (anios_prod ==0) {document.getElementById("titulomodalestadistico").innerText=("Resumen Estad√≠stico"); document.getElementById("cuerpomodalestadistico").innerText="Criterios de filtro: "+criterio+
			" - "+valor+"\nCantidad de parcelas: "+tot_parc+"\nSuperficie: "+sup_total.toFixed(2)+" ha"};
		cobertura_vid.value="";
		document.getElementById("quitartodo").style.visibility='visible';
		document.getElementById("mostrartodo").style.visibility='visible';
	};

	<!--Funcion para filtrar parcelas con vid-->
	function Filtrar_Vid(feature) {
		if (grupoeeamza) {mapa.removeLayer(grupoeeamza)};
		barralateral.close();
		criterio="";
		if (Object.keys(capa_parcelas).length !==0) {capa_parcelas.remove()};
		var busqueda=cobertura_vid.value;
		var criterio = new RegExp(busqueda, "i");
		var resumen='<span>Criterio de filtro: <span style=color:blue><strong>Vid</strong>.</span><br><span>Variedad: <span style=color:blue><strong>'+busqueda+
			'</strong>.</span></span><br><span>Cantidad de Parcelas: <span style=color:blue><strong>'+tot_parc+'</strong>.</span></span><br><span>Superficie: <span style=color:blue><strong>'+
			sup_total.toFixed(2)+'</strong>.</span></span><br><span>Promedio de Producci√≥n Anual: <span style=color:blue><strong>'+(prom_prod/anios_prod/sup_total).toFixed(2)+" qq/ha"+'</strong>.</span></span>';
		document.getElementById("cuadroestadisticasbarralateral").style.visibility='visible';
		modal.style.visibility='visible';
		document.getElementById("estadisticasbarralateral").innerHTML=resumen;
		if (cobertura_vid.value !="") {if (criterio.test(feature.properties.Variedad)) return true; document.getElementById("titulomodalestadistico").innerText=("Resumen estad√≠stico");
			document.getElementById("cuerpomodalestadistico").innerHTML=resumen;AbrirModalEstadistico()};
		if (cobertura_vid.value !="") {if (feature.properties.Variedad==cobertura_vid.value) return true; document.getElementById("titulomodalestadistico").innerText=("Resumen estad√≠stico");
			document.getElementById("cuerpomodalestadistico").innerHTML=resumen;AbrirModalEstadistico()};
	};

	<!--Funcion para filtrado general-->	
	function Filtrar_Gral(feature) {
		if (grupoeeamza) {mapa.removeLayer(grupoeeamza)};
		if (criterio=="Clon" && sel_clon.value !=""){if (feature.properties.Clon==sel_clon.value) return true; resumen=otro_criterio.value+" "+sel_clon.value};
		if (criterio=="Cobertura" && sel_cobertura.value !=""){if (feature.properties.Cobertura==sel_cobertura.value) return true; resumen=otro_criterio.value+" "+sel_cobertura.value};
		if (criterio=="Conduccion" && sel_conduccion.value !=""){if (feature.properties.Conduccion==sel_conduccion.value) return true; resumen=otro_criterio.value+" "+sel_conduccion.value};
		if (criterio=="Especie" && sel_especie.value !=""){if (feature.properties.Especie==sel_especie.value) return true; resumen=otro_criterio.value+" "+sel_especie.value};
		if (criterio=="Responsable" && sel_responsable.value !=""){if (feature.properties.Responsabl==sel_responsable.value) return true; resumen=otro_criterio.value+" "+sel_responsable.value};
		if (criterio=="Riego" && sel_riego.value !=""){if (feature.properties.Riego==sel_riego.value) return true; resumen=otro_criterio.value+" "+sel_riego.value};
		if (criterio=="Plantacion" && sel_plantacion.value !=""){
			if (sel_plantacion.value=="Antes de 1990") {if (feature.properties.Plantacion<'1991' && feature.properties.Plantacion !=null) return true};
			if (sel_plantacion.value=="Entre 1991 y 2000") {
				base='1991'; tope='2000';
				if (feature.properties.Plantacion>=base && feature.properties.Plantacion<=tope && feature.properties.Plantacion !=null) return true};
			if (sel_plantacion.value=="Entre 2001 y 2010") {
				base='2001'; tope='2010';
				if (feature.properties.Plantacion>=base && feature.properties.Plantacion<=tope && feature.properties.Plantacion !=null) return true};
			if (sel_plantacion.value=="Entre 2011 y 2020") {
				base='2011'; tope='2020';
				if (feature.properties.Plantacion>=base && feature.properties.Plantacion<=tope && feature.properties.Plantacion !=null) return true};
			resumen=otro_criterio.value+": "+sel_plantacion.value;
		};
		if (criterio=="Superficie" && sel_superficie.value !=""){
			if (sel_superficie.value=="Menos de 0,1 ha") {if (feature.properties.Sup_Croqui <'0.1' && feature.properties.Sup_Croqui !=null) return true};
			if (sel_superficie.value=="Entre 0,1 y 0,2 ha") {
				base='0.1';tope='0.2';
				if (feature.properties.Sup_Croqui >=base && feature.properties.Sup_Croqui <tope & feature.properties.Sup_Croqui !=null) return true};
			if (sel_superficie.value=="Entre 0,2 y 0,3 ha") {
				base='0.2';tope='0.3';
				if (feature.properties.Sup_Croqui >=base && feature.properties.Sup_Croqui <tope && feature.properties.Sup_Croqui !=null) return true};
			if (sel_superficie.value=="Entre 0,3 y 0,5 ha") {
				base='0.3';tope='0.5';
				if (feature.properties.Sup_Croqui>=base && feature.properties.Sup_Croqui<tope && feature.properties.Sup_Croqui!=null) return true};
			if (sel_superficie.value=="Entre 0,5 y 0,7 ha") {
				base='0.5';tope='0.7';
				if (feature.properties.Sup_Croqui>=base && feature.properties.Sup_Croqui<tope && feature.properties.Sup_Croqui!=null) return true};
			if (sel_superficie.value=="Entre 0,7 y 1 ha") {
				base='0.7';tope='1';
				if (feature.properties.Sup_Croqui>=base && feature.properties.Sup_Croqui<tope && feature.properties.Sup_Croqui!=null) return true};
			if (sel_superficie.value=="Entre 1 y 2 ha") {
				base='1';tope='2';
				if (feature.properties.Sup_Croqui>=base && feature.properties.Sup_Croqui<tope && feature.properties.Sup_Croqui!=null) return true};
			if (sel_superficie.value=="Entre 2 y 3 ha") {
				base='2';tope='3';
				if (feature.properties.Sup_Croqui>=base && feature.properties.Sup_Croqui<tope && feature.properties.Sup_Croqui!=null) return true};
			if (sel_superficie.value=="Mayor a 3 ha") {if (feature.properties.Sup_Croqui>='3' && feature.properties.Sup_Croqui!=null) return true};
			resumen=otro_criterio.value+": "+sel_superficie.value;
		};
		modal.style.visibility='visible';
	};

	<!--Funcion para buscar sector/actividad-->
	function Filtrar_Buscar(feature) {
		if (grupoeeamza) {mapa.removeLayer(grupoeeamza)};
		criterio="";
		if (feature.properties.Descripcio==inputbusqueda.value) {return true,coincidencia="sector",sector=feature.properties.Descripcio};
		if (feature.properties.Actividad==inputbusqueda.value || feature.properties.Actividad1==inputbusqueda.value || feature.properties.Actividad2==inputbusqueda.value
		|| feature.properties.Actividad3==inputbusqueda.value) {return true,sector=feature.properties.Descripcio,coincidencia="actividad"};
	};

	<!--Funcion para buscar persona/especialidad-->
	function Filtrar_Buscar1(feature) {
		if (feature.properties.Persona==inputbusqueda.value && feature.properties.Ofi_Lab !==null) {return true,sector=feature.properties.Sector,coincidencia="persona",oficina=feature.properties.Ofi_Lab};
		if (feature.properties.Persona==inputbusqueda.value && feature.properties.Ofi_Lab ==null) {return true,sector=feature.properties.Sector,coincidencia="persona"};
		if (feature.properties.Especial==inputbusqueda.value || feature.properties.Especial1==inputbusqueda.value
			|| feature.properties.Especial2==inputbusqueda.value || feature.properties.Ofi_Lab==inputbusqueda.value)
				{return true,sector=feature.properties.Sector,coincidencia="especialidad",persona=feature.properties.Persona};
	};

	function Filtrar_Buscar2(feature) {
		if (feature.properties.Descripcio==sector) {return true,sector=feature.properties.Descripcio};
	};

	<!--Funci√≥n para encontrar una persona o lugar-->
	function EncontrarA(encontrar) {
		<!--Resetear variables-->
		barralateral.close();
		var buscado=encontrar;
		//ResetearTodo();
		coincidencia="";
		sector="";
		oficina="";
		msgencontrado="";
		actualizarruta="si";
		aer="";
		<!--Borrar las b√∫squedas anteriores-->
		if (version=="completa") {
			if (Object.keys(capa_parcelas).length !==0) {capa_parcelas.remove()};
			if (Object.keys(capa_filtrada).length !== 0) {capa_filtrada.remove()};
		};
		if (Object.keys(capa_buscar).length !==0) {capa_buscar.remove()};
		if (Object.keys(capa_buscar1).length !==0) {capa_buscar1.remove()};
		if (lugar !==""){lugar.remove()};
		<!--Generar la capa con el resultado de la b√∫squeda-->
		capa_buscar=L.geoJSON(parcelas,{filter:Filtrar_Buscar, style: PersonalizarBusquedas, onEachFeature}).addTo(mapa);
		<!--No se encontr√≥ lo que se busca por coincidencia con el Sector o la especialidad de √©ste; as√≠ que se pasa a buscar por coincidencia con persona o sus especialidades-->
		if (Object.keys(capa_buscar._layers).length ==0) {capa_buscar=L.geoJSON(personal,{filter:Filtrar_Buscar1,style: PersonalizarBusquedas, onEachFeature}).addTo(mapa),
		capa_buscar1=L.geoJSON(parcelas,{filter:Filtrar_Buscar2, style:PersonalizarBusquedas, onEachFeature}).addTo(mapa);
		capa_buscar.remove();
		};
		mapa.flyToBounds(capa_buscar.getBounds(),18);
		if (!coordenadas_ubicacion_real=="" && orientarme=="") {
			titulomodalflash.innerText="TRAZAR RUTA";
			cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¬øNecesit√°s ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
			'a partir de tu ubicaci√≥n actual y brindarte algunas indicaciones.-<br></span>';
			btnindicacionesmodalflash.style.display='flex';
			btncerrarmodalflash.style.display='flex';
			btncerrarmodalflash.textContent = "No";
			tiempomodalflash=5000;
			ModalFlash(tiempomodalflash);
		};
	};

	<!--Funcion para resetear todo-->
	function ResetearTodo() {
		document.getElementById("volvereea").style.visibility='hidden';
		if (lugar){lugar.remove()};
		if (aer){aer.remove()};
		if (ruta) {ruta.remove()};
		if (marca_ubicacion_real) {marca_ubicacion_real.remove()};
		if (grupoeeamza) {mapa.removeLayer(grupoeeamza)};
		if (perimetro) {mapa.removeLayer(perimetro)};
		if (superficie) {mapa.removeLayer(superficie)};
		botondetallesruta.style.display='none';
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		aer="";
		mail="";
		coordenadas_ubicacion_real="";
		distancia="";
		iraaer="";
		lugar="";
		temporizadormodalflash="";
		orientarme="";
		if (version=="completa") {
			if (Object.keys(capa_parcelas).length !==0) {capa_parcelas.remove()};
			if (Object.keys(capa_filtrada).length !== 0) {capa_filtrada.remove()};
			if (Object.keys(capa_buscar).length !==0) {capa_buscar.remove()};
			if (Object.keys(capa_buscar1).length !==0) {capa_buscar1.remove()};
			tot_parc=0;
			sup_total=0;
			prom_prod=0;
			anios_prod=0;
			criterio="";
			otro_criterio.value="";
			sel_clon.value="";
			sel_responsable.value="";
			sel_especie.value="";
			sel_cobertura.value="";
			sel_plantacion.value="";
			sel_riego.value="";
			sel_superficie.value="";
			sel_conduccion.value="";
			cobertura_vid.value="";
			mapa.flyTo(coordenadas, zum);
		};
		if (version=="publica") {
			if (Object.keys(capa_buscar).length !==0) {capa_buscar.remove()};
			if (Object.keys(capa_buscar1).length !==0) {capa_buscar1.remove()};
			mapa.flyTo(coordenadas, zum);
		};
	};

	<!-- Funcion para mostrar todas las parcelas-->
	function MostrarTodo() {
		ResetearTodo();
		capa_parcelas=L.geoJson(parcelas,{style: PersonalizarPerimetro, onEachFeature}).addTo(mapa);
		document.getElementById("quitartodo").style.visibility='visible';
		document.getElementById("mostrartodo").style.visibility='hidden';
	};

	<!--Verificar Sistema Operativo-->
	function VerificarDispositivo() {
		//const userAgent = navigator.userAgent || navigator.vendor || window.opera;
		//let so = "Desconocido";
		//if (/windows phone/i.test(userAgent)) {
		//	so = "Windows Phone";
		//} else if (/win/i.test(userAgent)) {
		//	so = "Windows";
		//} else if (/android/i.test(userAgent)) {
		//	so = "Android";
		//} else if (/ipad|iphone|ipod/i.test(userAgent)) {
		//	so = "iOS";
		//} else if (/mac/i.test(userAgent)) {
		//	so = "MacOS";
		//} else if (/linux/i.test(userAgent)) {
		//	so = "Linux";
		//};
		//sistema_operativo=so;
		const ancho = window.screen.width;
		const alto = window.screen.height;
		if (Math.min(ancho, alto) < 768) {so="movil"}  // tel√©fonos y tablets
		else {so="pc"};
		dispositivo=so;
		if (dispositivo=="pc") {document.getElementById("botonnorte").style.visibility="visible";minimapamundial.addTo(mapa)};
    };
	
	<!--Funcion para verificar estado de conectividad-->
	function VerificarConexion() {
		const online = navigator.onLine;
		online ? conexion="si" : conexion="no";
		if (conexion=="no") {
			titulomodalflash.innerText="SIN CONEXION";
			cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>No hay conexi√≥n a interntet.</b><br><br><span style="color:black">Por favor, busca la manera de conectarte para poder usar este visor web a pleno, es decir, con todas sus herramientas.-</span>';
			tiempomodalflash=4000;
			ModalFlash(tiempomodalflash);
		};
	};

	<!--Funci√≥n para verificar GPS-->
	function VerificarGPS() {
		<!--Sin GPS-->
		if (!navigator.geolocation) {
			titulomodalflash.innerText="SIN GPS";
			cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Oho...!!!.</b><br><br><span style="color:black">Parece que tu navegador o dispositivo no est√° funcionando con GPS...!!!.-<br>'+
			'Por lo tanto, no podr√°s ver tu ubicaci√≥n en tiempo real.</span>';
			tiempomodalflash=5000;
			ModalFlash(tiempomodalflash);
			senialgps="no";
		};
		if (!dispositivo==="pc") {navigator.geolocation.getCurrentPosition(
			<!--GPS Perfecto-->
			(pos) => {
				senialgps="si";
				const lat = pos.coords.latitude.toFixed(6);
				const lon = pos.coords.longitude.toFixed(6);
				const accuracy = pos.coords.accuracy;
			},
			<!--Alg√∫n problema con el GPS-->
			(error) => {
				senialgps="no";
				msg="‚ùå No se pudo acceder al GPS";
				if (error.code === 1) msg1 = "‚ùå Permiso de ubicaci√≥n denegado";
				else if (error.code === 2) msg1 = "‚ùå Posici√≥n no disponible";
				else if (error.code === 3) msg1 = "‚ùå Tiempo de espera agotado";
				titulomodalflash.innerText="SIN GPS";
				cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Oho...!!!.</b><br><br><span style="color:black">'+msg+'...!!!.-<br>'+
				'Debido a: '+msg1+'.-</span>';
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
				botondetallesruta.style.display="none";
			},
			{
				enableHighAccuracy: true,
				timeout: 5000,
				maximumAge: 0
			}
		)};
	};

	<!--Funci√≥n para activar el seguimiento en tiempo real y hacer zoom en √©l-->
	function activar_seguimiento(seguimiento) {
		sondeo_posicion=0;
		barralateral.close();
		document.getElementById("gps").src="./images/slide_on.jpg";
		document.getElementById("gpson").style.visibility='visible';
		document.getElementById("gpsoff").style.visibility='hidden';
		document.getElementById("dondestoy").style.visibility='visible';
		document.getElementById("ubicacion_estado").href="javascript:desactivar_seguimiento(seguimiento)";
		VerificarConexion();
		if (conexion==="si") {
			VerificarGPS();
			if (dispositivo=="pc" && orientarme=="") {
				titulomodalflash.innerText="TRAZAR RUTA";
				visitas.style.display="none";
				cantidadvisitas.style.display="none";
				cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>Puede que la ubicaci√≥n que te muestre NO SEA LA REAL.</b><br><br><span style="color:black">Parece que est√°s conectado desde una PC; por lo que la ubicaci√≥n tal vez sea la de tu proveedor de internet; en vez del lugar donde est√°s.-<br></span>';
				btnindicacionesmodalflash.style.display='none';
				btncerrarmodalflash.textContent = "Cerrar";
				tiempomodalflash=9000;
				ModalFlash(tiempomodalflash);
			};
			if (dispositivo==="pc") {botoncentrado.style.display='block'};
			cajadistancia.classList.add("visible");
			//botondetallesruta.style.display="block";
			seguimiento="si";
			mapa.locate({setView: false, watch: true, enableHighAccuracy: true});
			mapa.on('locationfound', ActualizarUbicacion);
			mapa.on('locationerror', ErrorGPS);
		};
	};

	// Evento al encontrar la ubicaci√≥n
	function ActualizarUbicacion(e) {
		if (coordenadas_ubicacion_real) {
			marca_ubicacion_real.remove();
			marca_ubicacion_real = L.marker(e.latlng,{icon:icono_posicion}).addTo(mapa)
				.bindPopup("Vas por aqu√≠");
			coordenadas_ubicacion_real=e.latlng;
		};
		if (!coordenadas_ubicacion_real) {
			marca_ubicacion_real = L.marker(e.latlng,{icon:icono_posicion}).addTo(mapa)
				.bindPopup("Est√°s por aqu√≠")
				.openPopup();
			coordenadas_ubicacion_real=e.latlng;
			mapa.setView(coordenadas_ubicacion_real, 17);
		};
		dentroeeamza = Chequeardentroeeamza(coordenadas_ubicacion_real);
		distancia=DistanciaEnTiempoReal();
		if (orientarme=="") {
			if (distancia>1100) {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¬øNecesit√°s ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
				'a partir de tu ubicaci√≥n actual y brindarte algunas indicaciones.-<br></span>';
				btnindicacionesmodalflash.style.display='flex';
				btncerrarmodalflash.style.display='flex';
				btncerrarmodalflash.innerHTML = "No";
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
			if (distancia<=1100 && distancia>7) {
				titulomodalflash.innerText="TRAZAR RUTA";
				cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¬øNecesit√°s ayuda para llegar?.</b><br><br><span style="color:black">Puedo mostrarte en tiempo real por d√≥nde vas '+
				'y el destino con vista de ambos puntos en el mapa.-<br></span>';
				btnindicacionesmodalflash.style.display='flex';
				btncerrarmodalflash.style.display='flex';
				btncerrarmodalflash.innerHTML = "No";
				tiempomodalflash=5000;
				ModalFlash(tiempomodalflash);
			};
		};
		if (orientarme=="si") {
			if (distancia<=1100) {
				botondetallesruta.style.display="none";
				panelrutas.style.display="none";
				if (ruta) {
					ruta.remove();
				};
			};
			if (distancia>1100) {
				botondetallesruta.style.display="block";
			};
		};
		if (distancia > 10) {
			if (distancia>6000) {msg="¬°Est√°s a unos "+(Math.round(distancia/1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" kil√≥metros del destino!"};
			if (distancia<6001) {msg="¬°Est√°s a unos "+(Math.round(distancia).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" metros del destino!"};
		};
		if (!dentroeeamza || aer || lugar) {
			cajadistancia.textContent = msg+" (En l√≠nea recta).-";
			cajadistancia.style.background = "#d4edda";
			cajadistancia.style.color = "#155724"
		} else {
			cajadistancia.textContent = "Est√°s dentro de la EEA Mendoza. La velocidad m√°xima recomendada para circular es de 30 km/h.-";
			cajadistancia.style.background = "#d4edda";
			cajadistancia.style.color = "#155724";
			botondetallesruta.style.display="none";
			
			
			
			const utterance = new SpeechSynthesisUtterance("La velocidad maxima recomendada para circular es de 30 kilometros por hora.-");
			speechSynthesis.speak(utterance);
			
			
			
			
		};
		//if ((distancia >80 && distancia <= 150) && (lugar !== "" || aer !== "")) {
		if (distancia >80 && distancia <= 180) {
			msg="Avanza despacio y con atenci√≥n. ¬°Est√°s a pocos metros del destino!";
			if (avisollegada=="si") {AlertaLlegada(msg)};
		};
		if (distancia>10 && distancia<80) {avisollegada="si"};
		//if ((distancia <= 10) && (lugar !=="" || aer !=="")) {
		if (distancia <= 10) {
			cajadistancia.textContent = "¬°Has llegado a tu destino!.-";
			refrescoRutaActivo = false;
			clearInterval(intervaloRuta);
			intervaloRuta = null;
			setTimeout(() => {
				cajadistancia.classList.remove("visible");
			}, 10000);
			mapa.setView(coordenadas_ubicacion_real, 19);
			if (avisollegada=="si") {AlertaLlegada("Has llegado a tu destino "+msgencontrado)};
		};
	};

	// Evento en caso de error
	function ErrorGPS(e) {
		cajadistancia.classList.add("visible");
		cajadistancia.textContent = "No se pudo obtener la ubicaci√≥n: " + e.message;
		cajadistancia.style.background = "white";
		cajadistancia.style.color = "red";
		botondetallesruta.style.display='none';
	};
	
	//Anuncio en voz alta de cercan√≠a/llegada a destino
	function AlertaLlegada(leerdistancia) {
		const utterance = new SpeechSynthesisUtterance(leerdistancia);
		speechSynthesis.speak(utterance);
		if (distancia>7) {avisollegada="no"};
		if (distancia<=7) {avisollegada="no";DetenerActualizarUbicacion()};
		clearTimeout(temporizadormodalflash);
	};
	
	function DistanciaEnTiempoReal() {
		const point = turf.point([coordenadas_ubicacion_real.lng, coordenadas_ubicacion_real.lat]);
		if (!lugar && !aer) {
			return (centroide.distanceTo(coordenadas_ubicacion_real));
		};
		if (lugar && !aer) {
			const lineSegments = [];
			const coords = poligono[0];
			for (let i = 0; i < coords.length - 1; i++) {
				lineSegments.push(turf.lineString([coords[i], coords[i + 1]]));
			};
			let minDistance = Infinity;
			let nearestPoint = null;
			let nearestSegment = null;
			lineSegments.forEach(segment => {
				const snapped = turf.nearestPointOnLine(segment, point);
				const dist = turf.distance(point, snapped, {units: 'meters'});
				if (dist < minDistance) {
					minDistance = dist;
					nearestPoint = snapped;
					nearestSegment = segment;
				};
			});
			const snappedCoords = [nearestPoint.geometry.coordinates[1], nearestPoint.geometry.coordinates[0]];
			return minDistance;
		};
		if (!lugar && aer) {
			return (centroide.distanceTo(coordenadas_ubicacion_real));
		};
	};
	
	function Chequeardentroeeamza(coords) {
		const pt = turf.point([coords.lng, coords.lat]);
		let found = null;
		for (const f of inta.features) {
			if (["Polygon", "MultiPolygon"].includes(f.geometry.type)) {
				if (turf.booleanPointInPolygon(pt, f)) {
					found = f;
					break;
				}
			}
		}
		return found;
	};
	
	// Funci√≥n para detener geolocalizaci√≥n
	function DetenerActualizarUbicacion() {
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		actualizarruta="si";
		document.getElementById("dondestoy").style.visibility='hidden';
		if (ruta) {ruta.remove()};
		botondetallesruta.style.display='none';
		coordenadas_ubicacion_real="";
		distancia="";
		mapa.stopLocate();
		mapa.off('locationfound', ActualizarUbicacion);
		mapa.off('locationerror', ErrorGPS);
		if (marca_ubicacion_real) {
			marca_ubicacion_real.remove();
			coordenadas_ubicacion_real = "";
			marca_ubicacion_real = "";
		};
		titulomodalflash.innerText="SEGUIMIENTO DETENIDO";
		cuerpomodalflash.innerHTML = '<span style="display: block; text-align: center; width: 100%; color:green;"><br><b>Servicio de seguimiento en tiempo real detenido.</b><br><br><span style="color:black">'+
		'No podr√°s visualizar tu posici√≥n ni recibir indicaciones para llegar a un lugar.'+
		'<br><br>Podr√°s volver a activarla en el momento que lo desees.</span>';
		tiempomodalflash=5000;
		//btncerrarmodalflash.textContent === "Cerrar";
		ModalFlash(tiempomodalflash);
	};

	<!--Funci√≥n para Centrar en Mi Ubicaci√≥n Actual-->
	function CentrarMiUbicacion() {
		barralateral.close();
		mapa.setView(coordenadas_ubicacion_real, 17);
	};

	<!--Funci√≥n para detener el seguimiento en tiempo real-->
	function desactivar_seguimiento(seguimiento) {
		botondetallesruta.style.display='none';
		barralateral.close();
		seguimiento="";
		orientarme="";
		document.getElementById("gps").src="./images/slide_off.jpg";
		document.getElementById("gpson").style.visibility='hidden';
		document.getElementById("gpsoff").style.visibility='visible';
		botoncentrado.style.display='none';
		cajadistancia.classList.remove("visible");
		document.getElementById("dondestoy").style.visibility='hidden';
		document.getElementById("ubicacion_estado").href="javascript:activar_seguimiento(seguimiento)";
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		if (ruta) {ruta.remove()};
		botondetallesruta.style.display='none';
		coordenadas_ubicacion_real="";
		distancia="";
		mapa.stopLocate();
		if (marca_ubicacion_real) {
			marca_ubicacion_real.remove();
			coordenadas_ubicacion_real = "";
			marca_ubicacion_real = "";
		};
		titulomodalflash.innerText="SEGUIMIENTO DETENIDO";
		cuerpomodalflash.innerHTML = '<span style="display: block; text-align: center; width: 100%; color:green;"><br><b>Servicio de seguimiento en tiempo real detenido.</b><br><br><span style="color:black">'+
		'No podr√°s visualizar tu posici√≥n ni recibir indicaciones para llegar a un lugar.'+
		'<br><br>Podr√°s volver a activarla en el momento que lo desees.</span>';
		btncerrarmodalflash.textContent = "Cerrar";
		tiempomodalflash=5000;
		ModalFlash(tiempomodalflash);
		if (ruta) {ruta.remove()};
		iraaer="";
		mail="";
	};
	
	function RefrescarRuta() {
		if (!refrescoRutaActivo) return;
		TrazarRuta();
		setTimeout(RefrescarRuta, 300000); // 5 minutos
	};
	
	function IniciarRuteo() {
		if (refrescoRutaActivo) return;
		refrescoRutaActivo = true;
		RefrescarRuta(); // arranca
	};
	
	function TrazarRuta() {
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		modalinicial.close();
		mimodalflash.style.display='none';
		btnindicacionesmodalflash.style.display='none';
		visitas.style.display='none';
		document.getElementById("borrableinicial").style.display='none';
		botoncentrado.style.display="block";
		VerificarConexion();
		if (conexion === "si") VerificarGPS();
		distancia = DistanciaEnTiempoReal();
		avisollegada = "si";
		// üö∂ Cerca del destino ‚Üí NO rutea, pero NO mata el intervalo
		if (distancia <= 1100) {
			ActualizarUbicacion();
			return;
		}
		// üî• eliminar ruta anterior
		if (ruta) {
			mapa.removeControl(ruta);
			ruta = null;
		}
		// üî• crear nueva ruta
		ruta = L.Routing.control({
			waypoints: [
				L.latLng(coordenadas_ubicacion_real.lat, coordenadas_ubicacion_real.lng),
				L.latLng(centroide.lat, centroide.lng)
			],
			router: L.Routing.osrmv1({
				serviceUrl: 'https://router.project-osrm.org/route/v1',
				language: 'es'
			}),
			showAlternatives: true,
			draggableWaypoints: false,
			createMarker: () => null,
			lineOptions: {
				styles: [{ color: 'red', weight: 9, opacity: 0.9 }]},
			altLineOptions: {styles: [{color: 'blue', weight: 6, opacity: 0.6, dashArray: '8,12'}]} 
		}).addTo(mapa);
		botondetallesruta.style.display = "block";
		panelrutas.style.display = "block";
		panelrutas.replaceChildren(ruta.getContainer());
	};


	
	

	<!--Funcion para mostrar imagen estad√≠sticas en ventana modal-->
	function Funcion_Modal(imagen, titulo, leyenda, ancho, alto) {
		var left = (screen.weight / 2)-(ancho/2);
		var top = (screen.height / 2)-(alto/2);
		document.getElementById("titulomodalgrafico").innerText=titulo;
		document.getElementById("titulomodalgrafico").style.color = "blue";
		document.getElementById("titulomodalgrafico").style.font="italic bold 22px arial,serif";
		document.getElementById("imagenmodalgrafico").src="./images/"+imagen+".jpg";
		document.getElementById("subtitulomodalgrafico").innerText="Parcela N¬∫: "+imagen+". Responsable: "+leyenda;
		document.getElementById("Modal_Grafico").showModal();
	};

	<!--Funci√≥n para armar el arreglo de sectores-->
	function ListaSectores(feature, layer) {
		if (feature.properties.Cobertura !="Cultivo" && feature.properties.Descripcio !="Vivienda" && feature.properties.Cobertura !="Invernaculo" && feature.properties.Descripcio !="Deposito"
			&& feature.properties.Descripcio !=null) {
			listabusqueda.push(feature.properties.Descripcio);
		};
		if (feature.properties.Cobertura !="Cultivo" && feature.properties.Descripcio !="Vivienda" && feature.properties.Cobertura !="Invernaculo" && feature.properties.Actividad !=null) {
			listabusqueda.push(feature.properties.Actividad);
		};
		if (feature.properties.Cobertura !="Cultivo" && feature.properties.Descripcio !="Vivienda" && feature.properties.Cobertura !="Invernaculo" && feature.properties.Actividad1 !=null) {
			listabusqueda.push(feature.properties.Actividad1);
		};
		if (feature.properties.Cobertura !="Cultivo" && feature.properties.Descripcio !="Vivienda" && feature.properties.Cobertura !="Invernaculo" && feature.properties.Actividad2 !=null) {
			listabusqueda.push(feature.properties.Actividad2);
		};
		if (feature.properties.Cobertura !="Cultivo" && feature.properties.Descripcio !="Vivienda" && feature.properties.Cobertura !="Invernaculo" && feature.properties.Actividad3 !=null) {
			listabusqueda.push(feature.properties.Actividad3);
		};
	};

	<!--Funci√≥n para armar el arreglo de personas y especialidades-->
	function ListaPersonas(feature, layer) {
		if (feature.properties.Persona !=null) {
			listabusqueda.push(feature.properties.Persona);
		};
		if (feature.properties.Especial !=null) {
			listabusqueda.push(feature.properties.Especial);
		};
		if (feature.properties.Especial1 !=null) {
			listabusqueda.push(feature.properties.Especial1);
		};
		if (feature.properties.Especial2 !=null) {
			listabusqueda.push(feature.properties.Especial2);
		};
		if (feature.properties.Ofi_Lab !=null) {
			listabusqueda.push(feature.properties.Ofi_Lab);
		};
	};

	<!--Funci√≥n para cargar el listbox-->
	function CargarListbox() {
		geojson = L.geoJson(parcelas, {onEachFeature: ListaSectores}).addTo(mapa);
		geojson.remove();
		geojson1 = L.geoJson(personal, {onEachFeature: ListaPersonas}).addTo(mapa);
		geojson1.remove();
		listabusqueda.sort();
		listabusquedafiltrada = listabusqueda.filter((elemento, index) => {
			return listabusqueda.indexOf(elemento) === index;
		});
	};
		
	function PrepararMail() {
		barralateral.close();
		visitas.style.display='none';
		titulomodalflash.innerText="ENVIAR MAIL AL DESARROLLADOR";
		cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>En un momento, enviar√°s el mail al desarrollador.</b><br><br><span style="color:black">Por par√°metros de configuraci√≥n de tu dispositivo, '+
		'es probable que no sea posible hacer un env√≠o semi-autom√°tico del mail.<br><br>Si al cerrar este mensaje no se env√≠a, abr√≠ tu aplicaci√≥n de correo electr√≥nico y peg√° la direcci√≥n de mail que ha sido '+
		'copiada en el portapapeles.-</span>';
		tiempomodalflash=12000;
		iraaer="";
		mail="si";
		navigator.clipboard.writeText("cmauriciogodoy@gmail");
		ModalFlash(tiempomodalflash);
	};

	function EnviarMail () {
		mail=""
		VerificarConexion();
		if (conexion=="si") {
			let a = document.createElement('a');
			let link = document.createTextNode("This is link");
			a.appendChild(link);
			a.href = "mailto:cmauriciogodoy@gmail.com?subject=SITIO WEB DEL INTA&body=Estimado Mauricio: Deseo hacerte el siguiente aporte como sugerencia (o informe de error) del sitio web del INTA. ........"+
				"(Explic√° con el mayor detalle posible tu comentario).-";
			a.id="a";
			document.body.appendChild(a);
			document.getElementById('a').click();
			document.body.removeChild(a);
		};
	};

	function IrUnidad(agencia) {
		iraaer="si";
		mail="";
		encontrar_a.value = "";
		encontrar_a.placeholder = "¬øBusc√°s algo o alguien?...";
		if (aer !=="") {aer.remove()};
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		if (ruta) {ruta.remove()};
		if (lugar) {lugar.remove()};
		lugar="";
		if (agencia=="Agencia de Extensi√≥n Guaymall√©n") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-32.88053993173516, -68.77169734266394".split(",");
			centroide=L.latLng(-32.88053993173516, -68.77169734266394);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Agencia de Extensi√≥n Guaymall√©n"+"</h4></b><br/><u>Direcci√≥n</u>: Mathus Hoyos s/n, Bermejo, Guaymall√©n."+
				"<br/>Predio de la Escuela T√©cnica Miguel Amado Pouget"+"<br/><u>Tel√©fono</u>: 11-6562-6368."+"<br/><u>Mail</u>: bakos.pedro@inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Agencia de Extensi√≥n Lavalle") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-32.72140116246021, -68.59081481151209".split(",");
			centroide=L.latLng(-32.72140116246021, -68.59081481151209);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Agencia de Extensi√≥n Lavalle"+"</h4></b><br/><u>Direcci√≥n</u>: Belgrano y Las Heras, Lavalle."+"<br/><u>Tel√©fono</u>: 11-6864-5337."+
				"<br/><u>Mail</u>: valentin.mariana@inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Agencia de Extensi√≥n Luj√°n de Cuyo") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-33.004316166957665, -68.86629766891129".split(",");
			centroide=L.latLng(-33.004316166957665, -68.86629766891129);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Agencia de Extensi√≥n Luj√°n de Cuyo"+"</h4></b><br/><u>Direcci√≥n</u>: San Mart√≠n 3853, Mayor Drummond, Luj√°n de Cuyo."+"<br/><u>Tel√©fono</u>: 11-6056-6027."+"<br/><u>Mail</u>: espindola.rodrigo@inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Agencia de Extensi√≥n Maip√∫") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-32.98581159851684, -68.78770732344232".split(",");
			centroide=L.latLng(-32.98581159851684, -68.78770732344232);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Agencia de Extensi√≥n Maip√∫"+"</h4></b><br/><u>Direcci√≥n</u>: Pablo Pescara 79, Maip√∫."+"<br/><u>Tel√©fono</u>: 11-6864-3738."+"<br/><u>Mail</u>: villar.elisa@inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Oficina de Informaci√≥n Uspallata") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-32.59050058989425, -69.34690529948934".split(",");
			centroide=L.latLng(-32.59050058989425, -69.34690529948934);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Oficina de Informaci√≥n T√©cnica Uspallata"+"</h4></b><br/><u>Direcci√≥n</u>: Rutas 7 y 52, Uspallata."+"<br/>Terminal de Omnibus de Uspallata."+"<br/><u>Tel√©fono</u>: 2954-398215."+"<br/><u>Mail</u>: lang.maria@inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Experimental San Juan") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-31.653709919609067, -68.58741520721456".split(",");
			centroide=L.latLng(-31.653709919609067, -68.58741520721456);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental San Juan"+"</h4></b><br/><u>Direcci√≥n</u>: Calle 11 y Vidart, Villa Aberastain."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Experimental Jun√≠n") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-33.114191328346095, -68.48699997987025".split(",");
			centroide=L.latLng(-33.114191328346095, -68.48699997987025);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental Jun√≠n"+"</h4></b><br/><u>Direcci√≥n</u>: Carril Isidoro Busquets s/n¬∞, La Colonia, Jun√≠n."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Agencia de Extensi√≥n Jun√≠n") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-33.114191328346095, -68.48699997987025".split(",");
			centroide=L.latLng(-33.114191328346095, -68.48699997987025);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental Jun√≠n"+"</h4></b><br/><u>Direcci√≥n</u>: Carril Isidoro Busquets s/n¬∞, La Colonia, Jun√≠n."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Experimental La Consulta") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-33.70853283892101, -69.07446194262695".split(",");
			centroide=L.latLng(-33.70853283892101, -69.07446194262695);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental La Consulta"+"</h4></b><br/><u>Direcci√≥n</u>: Ex Ruta 40, Km 96, La Consulta, San Carlos."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Agencia de Extensi√≥n La Consulta") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-33.70853283892101, -69.07446194262695".split(",");
			centroide=L.latLng(-33.70853283892101, -69.07446194262695);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental La Consulta"+"</h4></b><br/><u>Direcci√≥n</u>: Ex Ruta 40, Km 96, La Consulta, San Carlos."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (agencia=="Experimental Rama Ca√≠da") {
			var formatoPopup = {
				'maxWidth': '400',
				'className' : 'popups'};
			let coord="-34.66696115781422, -68.3925578892319".split(",");
			centroide=L.latLng(-34.66696115781422, -68.3925578892319);
			mapa.flyTo(coord, 16);
			let contenidoPopup="<b><h4>Estaci√≥n Experimental Rama Ca√≠da"+"</h4></b><br/><u>Direcci√≥n</u>: El Vivero s/n¬∫, San Rafael."+"<br/><u>Tel√©fono</u>: ."+"<br/><u>Mail</u>: @inta.gob.ar";
			aer=L.marker(coord).addTo(mapa)
				.bindPopup(contenidoPopup, formatoPopup)
				.openPopup();
			document.getElementById("volvereea").style.visibility='visible';
		};
		if (!coordenadas_ubicacion_real=="" && orientarme=="") {
			titulomodalflash.innerText="TRAZAR RUTA";
			cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>¬øNecesit√°s ayuda para llegar?.</b><br><br><span style="color:black">Puedo trazarte una ruta '+
			'a partir de tu ubicaci√≥n actual y brindarte algunas indicaciones.-<br></span>';
			btnindicacionesmodalflash.style.display='flex';
			btncerrarmodalflash.style.display='flex';
			btncerrarmodalflash.textContent = "No";
			tiempomodalflash=5000;
			ModalFlash(tiempomodalflash);
		};
	};

	function VolverEEA () {
		if (aer !="") {aer.remove(),document.getElementById("buscarunidad").value=""};
		let coord="-33.00598405638592, -68.85600484779212".split(",");
		document.getElementById("volvereea").style.visibility='hidden';
		mapa.flyTo(coord,16);
		grupoeeamza.addTo(mapa);
	};

	<!-- Control de la escala que se ir√° actualizando conforme se haga zoom -->
	new L.control.scale({imperial:false}).addTo(mapa);

	<!--Bloque Busqueda Unidades-->
	const inputbusquedaunidad = document.getElementById('buscarunidad');
	const sugerencia = document.getElementById('sugerenciasunidad');
	inputbusquedaunidad.addEventListener('input', () => {
		if (inputbusquedaunidad.value.trim() === '') {
			inputbusquedaunidad.classList.remove('filled');
			sugerencia.style.visibility='hidden';
		  };
		if (inputbusquedaunidad.value.trim() !=="") {
			sugerencia.style.visibility='visible';
			inputbusquedaunidad.classList.add('filled');
			const query = inputbusquedaunidad.value.toLowerCase();
			sugerencia.innerHTML = '';
			if (query.length === 0) return;
			const resultados = aers
			.filter(item => item.toLowerCase().includes(query))
			.slice(0,5); // Limitar a las primeras 5 coincidencias
			resultados.forEach(item => {
				const div = document.createElement('div');
				div.textContent = item;
				div.classList.add('sugerencia-item');
				div.addEventListener('click', () => {
					inputbusquedaunidad.value = item;
					sugerencia.innerHTML = '';
					IrUnidad(item);
					barralateral.close();
				});
				sugerencia.appendChild(div);
			});
		};
	});
	document.addEventListener('click', function(e) {
		if (!sugerencia.contains(e.target) && e.target !== inputbusquedaunidad) {
			sugerencia.innerHTML = '';
		};
	});
	
	<!--Bloque Busqueda Sectores, servicios, personas, especialidades Entrada Superior-->
	var inputbusqueda = document.getElementById('encontrar_a');
	const sugerenciaz = document.getElementById('sugerenciasbusqueda');
	inputbusqueda.addEventListener('input', () => {
		if (inputbusqueda.value.trim() === '') {
			inputbusqueda.classList.remove('filled');
			sugerenciaz.style.visibility='hidden';
		  };
		if (inputbusqueda.value.trim() !=="") {
			//botondetallesruta.style.display="none";
			sugerenciaz.style.visibility='visible';
			inputbusqueda.classList.add('filled');
			const query = inputbusqueda.value.toLowerCase();
			sugerenciaz.innerHTML = '';
			if (query.length === 0) return;
			const resultados = listabusquedafiltrada
			.filter(item => item.toLowerCase().includes(query))
			.slice(0,5); //Limitar a las primeras 5 coincidencias
			resultados.forEach(item => {
				const div = document.createElement('div');
				div.textContent = item;
				div.classList.add('sugerencia-item');
				div.addEventListener('click', () => {
					inputbusqueda.value = item;
					sugerenciaz.innerHTML = '';
					EncontrarA(item);
				});
				sugerenciaz.appendChild(div);
			});
		};
	});
	document.addEventListener('click', function(e) {
		if (!sugerenciaz.contains(e.target) && e.target !== inputbusqueda) {
			sugerenciaz.innerHTML = '';
		};
	});
	
	<!--Bloque Busqueda Sectores, servicios, personas, especialidades Entrada Barra Lateral-->
	var inputbusquedabis = document.getElementById('encontrar_abis');
	const sugerenciasbiz = document.getElementById('sugerenciasbusquedabis');
	inputbusquedabis.addEventListener('input', () => {
		if (inputbusquedabis.value.trim() === '') {
			inputbusquedabis.classList.remove('filled');
			sugerenciasbiz.style.visibility='hidden';
		  };
		if (inputbusquedabis.value.trim() !=="") {
			//botondetallesruta.style.display="none";
			sugerenciasbiz.style.visibility='visible';
			inputbusquedabis.classList.add('filled');
			const query = inputbusquedabis.value.toLowerCase();
			sugerenciasbiz.innerHTML = '';
			if (query.length === 0) return;
			const resultadosbis = listabusquedafiltrada
			.filter(item => item.toLowerCase().includes(query))
			.slice(0,5); //Limitar a las primeras 5 coincidencias
			resultadosbis.forEach(item => {
				const div = document.createElement('div');
				div.textContent = item;
				div.classList.add('sugerencia-item');
				div.addEventListener('click', () => {
					inputbusquedabis.value = item;
					sugerenciasbiz.innerHTML = '';
					barralateral.close();
					document.getElementById("encontrar_a").value=item;
					EncontrarA(item);
				});
				sugerenciasbiz.appendChild(div);
			});
		};
	});
	document.addEventListener('click', function(e) {
		if (!sugerenciasbiz.contains(e.target) && e.target !== inputbusquedabis) {
			sugerenciasbiz.innerHTML = '';
		};
	});

	// Bloque de la ventana modal
	const modal = document.getElementById("modalestadistico");
	const resizer = document.getElementById("resizeHandle");
	let offsetX = 0, offsetY = 0, isDragging = false;
	let startWidth = 0, startHeight = 0, startX = 0, startY = 0, isResizing = false;
	let minimized = false;
	
	function AbrirModalEstadistico() {
		modal.style.display = "block";
		// Cargar posici√≥n
		const pos = JSON.parse(localStorage.getItem("modalPosition") || "{}");
		modal.style.left = pos.left ? `${pos.left}px` : "20px";
		modal.style.top = pos.top ? `${pos.top}px` : "20px";
		// Cargar tama√±o
		const size = JSON.parse(localStorage.getItem("modalSize") || "{}");
		modal.style.width = size.width ? `${size.width}px` : "300px";
		modal.style.height = size.height ? `${size.height}px` : "300px";
	};
	
	function CerrarModal() {
		modal.style.visibility='hidden';
	};
	
	function MinimizarModalEstadistico() {
		minimized = !minimized;
		document.getElementById("cuerpomodalestadistico").style.display = minimized ? "none" : "block";
		resizer.style.display = minimized ? "none" : "block";
		modal.style.height = minimized ? "auto" : "200px";
	};
	
	// Mover modal (PC)
	modalestadisticocabecera.addEventListener("mousedown", e => {
		isDragging = true;
		offsetX = e.clientX - modal.offsetLeft;
		offsetY = e.clientY - modal.offsetTop;
		document.body.style.userSelect = "none";
	});
	
	document.addEventListener("mousemove", e => {
		if (isDragging) {
			modal.style.left = `${e.clientX - offsetX}px`;
			modal.style.top = `${e.clientY - offsetY}px`;
			SavePosition();
		};
	});
	
	document.addEventListener("mouseup", () => {
		isDragging = false;
		document.body.style.userSelect = "auto";
	});
	
	modalestadisticocuerpo.addEventListener("mousedown", e => {
		isDragging = true;
		offsetX = e.clientX - modal.offsetLeft;
		offsetY = e.clientY - modal.offsetTop;
		document.body.style.userSelect = "none";
	});
	
	document.addEventListener("mousemove", e => {
		if (isDragging) {
			modal.style.left = `${e.clientX - offsetX}px`;
			modal.style.top = `${e.clientY - offsetY}px`;
			SavePosition();
		};
	});
	
	document.addEventListener("mouseup", () => {
		isDragging = false;
		document.body.style.userSelect = "auto";
	});
	
	// Mover modal (touch)
	modalestadisticocabecera.addEventListener("touchstart", e => {
		isDragging = true;
		const touch = e.touches[0];
		offsetX = touch.clientX - modal.offsetLeft;
		offsetY = touch.clientY - modal.offsetTop;
	}, { passive: false });
	
	document.addEventListener("touchmove", e => {
		if (isDragging) {
			const touch = e.touches[0];
			modal.style.left = `${touch.clientX - offsetX}px`;
			modal.style.top = `${touch.clientY - offsetY}px`;
			SavePosition();
		};
	}, { passive: false });
	
	document.addEventListener("touchend", () => { isDragging = false; });
	modalestadisticocuerpo.addEventListener("touchstart", e => {
		isDragging = true;
		const touch = e.touches[0];
		offsetX = touch.clientX - modal.offsetLeft;
		offsetY = touch.clientY - modal.offsetTop;
	}, { passive: false });
	
	document.addEventListener("touchmove", e => {
		if (isDragging) {
			const touch = e.touches[0];
			modal.style.left = `${touch.clientX - offsetX}px`;
			modal.style.top = `${touch.clientY - offsetY}px`;
			SavePosition();
		};
	}, { passive: false });
	
	document.addEventListener("touchend", () => { isDragging = false; });
	
	// Redimensionar (PC)
	resizeHandle.addEventListener("mousedown", e => {
		isResizing = true;
		startWidth = modal.offsetWidth;
		startHeight = modal.offsetHeight;
		startX = e.clientX;
		startY = e.clientY;
		e.preventDefault();
	});
	
	document.addEventListener("mousemove", e => {
		if (isResizing) {
			modal.style.width = `${startWidth + (e.clientX - startX)}px`;
			modal.style.height = `${startHeight + (e.clientY - startY)}px`;
			SaveSize();
		};
	});
	
	document.addEventListener("mouseup", () => { isResizing = false; });
	
	// Redimensionar (touch)
	resizeHandle.addEventListener("touchstart", e => {
		isResizing = true;
		const touch = e.touches[0];
		startWidth = modal.offsetWidth;
		startHeight = modal.offsetHeight;
		startX = touch.clientX;
		startY = touch.clientY;
		e.preventDefault();
	}, { passive: false });
	
	document.addEventListener("touchmove", e => {
		if (isResizing) {
			const touch = e.touches[0];
			modal.style.width = `${startWidth + (touch.clientX - startX)}px`;
			modal.style.height = `${startHeight + (touch.clientY - startY)}px`;
			SaveSize();
	};
	}, { passive: false });
	
	document.addEventListener("touchend", () => { isResizing = false; });
	
	function SavePosition() {
		localStorage.setItem("modalPosition", JSON.stringify({
			left: parseInt(modal.style.left),
			top: parseInt(modal.style.top)
		}));
	};
	
	function SaveSize() {
		localStorage.setItem("modalSize", JSON.stringify({
			width: parseInt(modal.style.width),
			height: parseInt(modal.style.height)
		}));
	};
	
	//Funci√≥n para loguearse
	function Loguearse() {
		const valor = document.getElementById("username").value.trim().toLowerCase();
		const contra=document.getElementById("password").value.trim();
		if (usuarios.includes(valor) && contrasenias==contra) {
			document.getElementById("cerrarsesion").style.visibility='visible';
			document.getElementById("username").style.visibility='hidden';
			document.getElementById("password").style.visibility='hidden';
			document.getElementById("botonmostrarocultar").style.visibility='hidden';
			document.getElementById("botoningresar").style.visibility='hidden';
			tiempomodalflash=6000;
			titulomodalflash.innerText="INICIO DE SESION";
			cuerpomodalflash.innerHTML = '<span style="display: block; text-align: center; width: 100%; color:green;"><br><b>Te has validado correctamente.</b><br><br><span style="color:black">'+
			'Vas a tener acceso a la informaci√≥n de las parcelas con cultivos y los edificios.'+
			'<br><br>Cada vez que hagas una b√∫squeda o filtrado, emerger√° una ventana que te brindar√° un resumen estad√≠stico. La podr√°s mover, redimensionar y cerrar para mejorar la visibilidad.'+
			'Esa misma informaci√≥n estar√° disponible en la barra lateral.</span>';
			version="completa";
			barralateral.close();
			VerificarVersion();
			mapa.removeLayer(osm);
			mapa.addLayer(googlesatelite);
			capa=googlesatelite;
			ModalFlash(tiempomodalflash);
		} else {
			tiempomodalflash=5000;
			titulomodalflash.innerText="INICIO DE SESION";
			cuerpomodalflash.innerHTML = '<span style="color:red"><br><b>No has podido validarte correctamente.</b><br><br><span style="color:black">S√≥lo tendr√°s acceso a la informaci√≥n<br>b√°sica de la EEA Mendoza.</span>';
			version="publica";
			barralateral.close();
			VerificarVersion();
			ModalFlash(tiempomodalflash);
		}
    };
	
	//Funci√≥n para mostrar/ocultar contrase√±a
	function Contrasenia () {
		var estado=document.getElementById("password").type;
		var valor=document.getElementById("password").value;
		if (estado=="password") {document.getElementById("password").type="text";}
		else {document.getElementById("password").type="password"};
		document.getElementById("password").value = valor;
	};
	
	//Funci√≥n para cerrar sesi√≥n
	function CerrarSesion() {
		document.getElementById("username").style.visibility='visible';
		document.getElementById("password").style.visibility='visible';
		document.getElementById("botonmostrarocultar").style.visibility='visible';
			document.getElementById("botoningresar").style.visibility='visible';
		document.getElementById("cerrarsesion").style.visibility='hidden';
		barralateral.close();
		cuerpomodalflash.innerHTML = '<span style="display: block; text-align: center; width: 100%; color:red;"><br><b>Has cerrado sesi√≥n correctamente.</b><br><br><span style="color:black">S√≥lo tendr√°s acceso a la informaci√≥n<br>b√°sica de la EEA Mendoza.</span>';
		version="publica";
		tiempomodalflash=5000;
		VerificarVersion();
		mapa.removeLayer(googlesatelite);
		mapa.addLayer(osm);
		capa=osm;
		ModalFlash(tiempomodalflash);
	};
	
	//Bloque Modal Flash
	function ModalFlash(tiempo) {
		mimodalflash.style.display='block';
		//let interv;
		let timeout;
		let restante = tiempo/1000;
		document.getElementById('contador').textContent = restante;
		intervalo = setInterval(() => {
			restante--;
			document.getElementById('contador').textContent = restante;
			if (restante <= 0) clearInterval(intervalo);
			}, 1000);
		temporizadormodalflash=setTimeout(() => {
			btnindicacionesmodalflash.style.display='none';
			mimodalflash.style.display='none';
			clearTimeout(temporizadormodalflash);
			if (nomostrarinicial.checked) {localStorage.setItem('MOSTRAR_INICIAL', Version);document.getElementById("borrableinicial").style.display="none"};
			if (mail=="si") {EnviarMail()};
		}, tiempo);
	};
	
	<!--Funci√≥n Mostrar/Habilitar u Ocultar/Deshabilitar elementos seg√∫n la versi√≥n de trabajo-->
	function VerificarVersion() {
		if (version=="publica") {
			document.getElementById("cerrarsesion").style.visibility='hidden';
			mimodalflash.style.display='none';
			document.getElementById("titulo_vid").style.visibility='hidden';
			document.getElementById("titulo_otro_criterio").style.visibility='hidden';
			document.getElementById("cobertura_vid").style.visibility='hidden';
			document.getElementById("opciones_otr").style.visibility='hidden';
			document.getElementById("sel_cobertura").style.visibility='hidden';
			document.getElementById("sel_clon").style.visibility='hidden';
			document.getElementById("sel_conduccion").style.visibility='hidden';
			document.getElementById("sel_especie").style.visibility='hidden';
			document.getElementById("sel_plantacion").style.visibility='hidden';
			document.getElementById("sel_responsable").style.visibility='hidden';
			document.getElementById("sel_riego").style.visibility='hidden';
			document.getElementById("sel_superficie").style.visibility='hidden';
			document.getElementById("mostrartodo").style.visibility='hidden';
			document.getElementById("quitartodo").style.visibility='hidden';
			document.getElementById("titulousuario").style.visibility='visible';
			document.getElementById("titulocontrasenia").style.visibility='visible';
		};
		if (version=="completa") {
			document.getElementById("cerrarsesion").style.visibility='visible';
			mimodalflash.style.display='block';
			document.getElementById("titulo_vid").style.visibility='visible';
			document.getElementById("titulo_otro_criterio").style.visibility='visible';
			document.getElementById("cobertura_vid").style.visibility='visible';
			document.getElementById("opciones_otr").style.visibility='visible';
			document.getElementById("mostrartodo").style.visibility='visible';
			document.getElementById("quitartodo").style.visibility='visible';
			document.getElementById("titulousuario").style.visibility='hidden';
			document.getElementById("titulocontrasenia").style.visibility='hidden';
		};
	};
	
	//Bloque para las mediciones
	function AgregarPunto(e) {
		const latlng = e.latlng;
		if (cant_mediciones>0) {		
			markers.push(
				L.marker(latlng)
					.addTo(mapa)
			);
		};
		cant_mediciones=cant_mediciones+1;
		if (cant_mediciones>1) {
			if (modo === "distancia") {
				puntos.push(latlng);
				if (puntos.length > 1) {
					const i = puntos.length - 1;
					distanciaTotal += L.latLng(puntos[i-1]).distanceTo(L.latLng(puntos[i]));
				};
				if (perimetro) mapa.removeLayer(perimetro);
				perimetro = L.polyline(puntos, { color: 'red', weight: 4 }).addTo(mapa);
				resultado1.innerHTML = `Distancia total: ${FormatearDistancia(distanciaTotal)}`;
				resultado2.innerHTML = "";
			}
			else if (modo === "superficie") {
				puntos.push([latlng.lng, latlng.lat]);
				if (superficie) mapa.removeLayer(superficie);
				if (puntos.length >= 3) {
					const coordsCerrados = [...puntos, puntos[0]];
					superficie = L.polygon(coordsCerrados.map(p => [p[1], p[0]]), { color: 'blue', weight: 2, fillOpacity: 0.3 }).addTo(mapa);
					const turfPoly = turf.polygon([coordsCerrados]);
					const areaM2 = turf.area(turfPoly);
					const perimetroM = turf.length(turf.lineString(coordsCerrados), { units: 'meters' });
					resultado1.innerHTML = `Superficie: ${FormatearArea(areaM2)}`;
					resultado2.innerHTML = `Per√≠metro: ${FormatearDistancia(perimetroM)}`;
				} else {
					resultado1.innerHTML = "Superficie: ‚Äî";
					resultado2.innerHTML = "Per√≠metro: ‚Äî";
				}
			};
		};
	};
	
	function FormatearDistancia(m) {
		return m >= 1000 ? (m / 1000).toFixed(3) + ' m' : Math.round(m) + ' m';
	};
	
	function FormatearArea(m2) {
		return m2 >= 1_000_000 ? (m2 / 1_000_000).toFixed(2) + ' km¬≤ √≥ ' + (m2/10000).toFixed(2)+ ' ha' : (Math.round(m2.toFixed(2)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")) + ' m¬≤ √≥ ' + (m2/10000).toFixed(2)+ ' ha';
	};

	cambiarMedicion.addEventListener('click', () => {
		modo = modo === "superficie" ? "distancia" : "superficie";
		modoActual.innerHTML = `<strong>Modo:</strong> ${modo.charAt(0).toUpperCase() + modo.slice(1)}`;
		cambiarMedicion.innerText = modo === "distancia" ? "Cambiar a Superficie" : "Cambiar a Distancia";
		ResetearMediciones();
	});
	
	//Funci√≥n para resetear el contador del medidor de distancias/superficies
	function ResetearMediciones() {
		cant_mediciones=0;
		puntos = [];
		distanciaTotal = 0;
		if (markers) {
			markers.forEach(m => mapa.removeLayer(m));
			markers = [];
		};
		if (perimetro) {mapa.removeLayer(perimetro); perimetro = null;}
		if (superficie) {mapa.removeLayer(superficie); superficie = null;}
		resultado1.innerHTML = modo === "superficie" ? "Distancia total: ‚Äî" : "Superficie: ‚Äî";
		resultado2.innerHTML = "";
	};
	
	// ====================
	// FUNCI√ìN PARA CAMBIAR CAPA
	// ====================
		var capaActual = null;
	function cambiarCapa(nombre) {
		// Quitar capa anterior si existe
		if (capaActual && mapa.hasLayer(capaActual)) {
			mapa.removeLayer(capaActual);
		};
		// Cargar nueva capa
		var nueva = capasBase[nombre];
		if (nueva) {
			nueva.addTo(mapa);
			capaActual = nueva;
		};
		barralateral.close();
		actualizarOpciones(nombre);
	};
	// ====================
	// DESHABILITAR CAPA ACTUAL EN EL SELECT
	// ====================
	function actualizarOpciones(seleccionada) {
		var select = document.getElementById("listacapasbase");
		for (let o of select.options) {
			o.disabled = o.value === seleccionada;
		};
	};
	// ====================
	// EVENTO DEL SELECT
	// ====================
	document.getElementById("listacapasbase").addEventListener("change", function () {
		cambiarCapa(this.value);
	});
	// Capa inicial
	cambiarCapa(capa);
	
	// Bot√≥n para alternar captura de mediciones desde barra lateral
	document.getElementById("medir").addEventListener("click", function() {
		barralateral.close();
		cant_mediciones=1;
		document.getElementById("contenedorMediciones").style.visibility='visible';
		document.getElementById("BotonLimpiarPantalla").style.visibility='visible';
		capturaActiva = !capturaActiva;
		const icono=document.getElementById("imagenmediciones");
		if (capturaActiva) {
			mapa.on('click', AgregarPunto);
			document.getElementById("contenedorMediciones").style.visibility='visible';
		} else {
			mapa.off('click', AgregarPunto);
			document.getElementById("contenedorMediciones").style.visibility='hidden';
			ResetearMediciones();
		};
	});
	
	//Funci√≥n Despejar Pantalla
	function LimpiarPantalla() {
		// Opci√≥n 1: vaciar todo el body (excepto el bot√≥n)
		document.getElementById("medir").click();
		document.getElementById("contenedorMediciones").style.visibility='hidden';
		document.getElementById("BotonLimpiarPantalla").style.visibility='hidden';
		ResetearMediciones();
	};
	
	//Capturar evento sobre botones
	btncerrarmodalflash.addEventListener("click",()=>{
		btnindicacionesmodalflash.style.display='none';
		mimodalflash.style.display='none';
		visitas.style.display='none';
		document.getElementById("borrableinicial").style.display='none';
		modalinicial.close();
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(temporizadormodalflash);
		clearTimeout(tiempo);
		if (ruta) {ruta.remove();botondetallesruta.style.display="none"};
		if (nomostrarinicial.checked) {
			try {
				localStorage.setItem('MOSTRAR_INICIAL', Version);
				document.getElementById("borrableinicial").style.display="none";
			} catch(e){
				// ignore storage errors
				console.warn('No se pudo guardar preferencia en localStorage', e);
			}
		};
		if (btncerrarmodalflash.textContent.trim() === "No") {orientarme = "no"};
		avisollegada="no";
		if (mail==="si") {EnviarMail()};
		if (iraaer==="si") {IniciarRuteo()};
		visitas.style.display='none';
	});
	
	btnindicacionesmodalflash.addEventListener("click",()=>{
		visitas.style.display='none';
		clearTimeout(temporizadormodalflash);
		orientarme="si";
		avisollegada="si";
		if (distancia>6000) {msg="¬°Est√°s a unos "+(Math.round(distancia/1000).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" kil√≥metros del destino!"};
		if (distancia<6001) {msg="¬°Est√°s a unos "+(Math.round(distancia).toString().replace(/\B(?=(\d{3})+(?!\d))/g, "."))+" metros del destino!"};
		if (distancia<1100 && ruta) {ruta.remove();botondetallesruta.style.display='none'};
		cajadistancia.classList.add("visible");
		cajadistancia.textContent = msg+" (En l√≠nea recta).-";
		clearInterval(intervalo);
		clearInterval(intervaloRuta);
		clearTimeout(tiempo);
		
		
		
		
		titulomodalflash.innerText="TRAZAR RUTA";
		//visitas.style.display="none";
		//cantidadvisitas.style.display="none";
		cuerpomodalflash.innerHTML = '<span style="color:green"><br><b>Se te ofrecer√°n alertas por voz.</b><br><br><span style="color:black">Por lo tanto, asegurate de tener activado el sonido del dispositivo y a un volumen que puedas escucharlo sin distraerte demasiado.-<br></span>';
		btnindicacionesmodalflash.style.display='none';
		btncerrarmodalflash.textContent = "Cerrar";
		tiempomodalflash=5000;
		ModalFlash(tiempomodalflash);
		
		
		
		
	});

	// === BOT√ìN MOSTRAR / OCULTAR DETALLES RUTAS===
	let abierto = true;
	botondetallesruta.onclick = () => {
		abierto = !abierto;
		panelrutas.style.display = abierto ? "block" : "none";
		botondetallesruta.textContent = abierto ? "Detalles Ruta ‚ñæ" : "Detalles Ruta ‚ñ∏";
		mapa.invalidateSize();
	};
	
	const btncerrarmodalgrafico=document.querySelector("#btn-cerrar-modal-grafico");
	const modalgrafico=document.querySelector("#Modal_Grafico");
	btncerrarmodalgrafico.addEventListener("click",()=>{modalgrafico.close();});
	const botonnorte=document.getElementById("botonnorte");
	btncerrarmodalinicial.addEventListener("click",()=>{
		document.getElementById("borrablecelular").style.display='none';
		modalinicial.close()
	});
	
	//Bloque para resaltar o remarcar lo nuevo
		const elementonovedoso = document.getElementById('barralateral');
		const novedaden="barralateral";//Cambiar si fuera otro elemento el que contenga la novedad
		// Fechas de inicio y fin para resaltar o remarcar una novedad (pueden incluir hora si quer√©s)
		const inicio = new Date("2025-11-01"); //yyyy-mm-dd
		const fin = new Date("2026-01-30"); //yyyy-mm-dd
		const hoy = new Date();
		const cartelnuevo = document.getElementById('cartelnuevo');
		if (hoy >= inicio && hoy <= fin && Version !==localStorage.getItem('MOSTRAR_NUEVO')) {
			elementonovedoso.classList.add('resaltarlonovedoso');
			abrirnovedad();
			const tiempo = setTimeout(() => {
				elementonovedoso.classList.remove('resaltarlonovedoso');
				cerrarnovedad();
			}, 25000);
		} else {
			cerrarnovedad();
		};
		
		//Bloque para LO NUEVO
		function abrirnovedad(){
			cartelnuevo.style.display = 'block';
			// posicionar la gu√≠a apuntando al bot√≥n
			if (dispositivo !=="movil") {document.getElementById("flecharoja").style.visibility='visible'};
			posicionnovedad();
			// animaci√≥n de aparici√≥n
			requestAnimationFrame(()=> cartelnuevo.classList.add('show'));
		};

		function cerrarnovedad(){
			cartelnuevo.classList.remove('show');
			// despu√©s de la transici√≥n, ocultamos
			setTimeout(()=> cartelnuevo.style.display = 'none', 160);
			document.getElementById("flecharoja").style.visibility='hidden';
			if (nomostrarlonuevo.checked) {
				try {
					localStorage.setItem('MOSTRAR_NUEVO', Version);
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			}
		};

		function posicionnovedad(){
			if (novedaden !=="barralateral") {
				const btnRect = elementonovedoso.getBoundingClientRect();
				const gRect = cartelnuevo.getBoundingClientRect();
				const margin = 10; // separaci√≥n m√≠nima

				// ancho disponible y c√°lculo base
				const viewportW = document.documentElement.clientWidth;
				const viewportH = document.documentElement.clientHeight;

				// calculamos left centrado respecto al bot√≥n
				let left = btnRect.left + (btnRect.width/2) - (gRect.width/2);
				//let top=btnRect.height/2;//Para el caso de tratarse de la barra lateral
				// recortamos para que no se salga de la pantalla
				left = Math.max(8, Math.min(left, viewportW - gRect.width - 8));

				// por defecto situamos arriba del bot√≥n
				let top = btnRect.top - gRect.height - margin;
				//let left=75;//Para el caso de tratarse de la barra lateral
				cartelnuevo.classList.remove('bottom');

				// si no cabe arriba, lo ponemos abajo
				if(top < 8){
				top = btnRect.bottom + margin;
				cartelnuevo.classList.add('bottom');
				}

				cartelnuevo.style.left = left + 'px';
				cartelnuevo.style.top = top + 'px';

				// posicionamos la flecha horizontalmente para que apunte al centro del bot√≥n
				// calculamos la diferencia entre el centro del modal y el centro del bot√≥n
				const modalCenterX = left + gRect.width/2;
				const btnCenterX = btnRect.left + btnRect.width/2;
				// queremos que --arrow-x sea la mitad de la flecha (negativa) + offset para centrar
				const arrowOffset = btnCenterX - modalCenterX;
				// la pseudo-element tiene left:50% y margin-left: calc(var(--arrow-x, -7px))
				// as√≠ que ponemos --arrow-x en px
				cartelnuevo.style.setProperty('--arrow-x', (arrowOffset - 7) + 'px');
			} else {
				cartelnuevo.style.left = '7%';
				cartelnuevo.style.top = '50%';
				document.querySelector('.novedad').classList.add('oculto');
			};
		};

		// reposicionar si hay resize o scroll
		window.addEventListener('resize', ()=>{
			if(cartelnuevo.style.display !== 'none') posicionnovedad();
		});
		window.addEventListener('scroll', ()=>{
			if(cartelnuevo.style.display !== 'none') posicionnovedad();
		}, {passive:true});

		// tambien cerrar con escape
		document.addEventListener('keydown', (e)=>{
			if(e.key === 'Escape') cerrarnovedad();
		});
		
		nomostrarinicial.addEventListener("click",()=>{
			btnindicacionesmodalflash.style.display='none';
			mimodalflash.style.display='none';
			modalinicial.close();
			if (nomostrarinicial.checked) {
				try {
					localStorage.setItem('MOSTRAR_INICIAL', Version);
					document.getElementById("borrableinicial").style.display="none";
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			};
			avisollegada="no";
			clearTimeout(temporizadormodalflash);
			tiempomodalflash=5000;
		});
		
		nomostrarcelular.addEventListener("click",()=>{
			if (nomostrarcelular.checked) {
				try {
					localStorage.setItem('MOSTRAR_CELULAR', 'no');
					document.getElementById("borrablecelular").style.display="none";
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			};
			modalinicial.close()
		});
		
		nomostrarlonuevo.addEventListener("click",()=>{
			cartelnuevo.classList.remove('show');
			// despu√©s de la transici√≥n, ocultamos
			setTimeout(()=> cartelnuevo.style.display = 'none', 160);
			document.getElementById("flecharoja").style.visibility='hidden';
			if (nomostrarlonuevo.checked) {
				try {
					localStorage.setItem('MOSTRAR_NUEVO', Version);
					elementonovedoso.classList.remove('resaltarlonovedoso');
				} catch(e){
					// ignore storage errors
					console.warn('No se pudo guardar preferencia en localStorage', e);
				}
			}
		});
	
	//Funci√≥n para volver a mostrar los modales o mensajes cancelados por el usuario
	function RestablecerNoMostrar() {
		let inicial = Version;
		let numer = Number(inicial);
		let numero=numer-1;
		localStorage.setItem('MOSTRAR_INICIAL', numero);
		localStorage.setItem('MOSTRAR_NUEVO', numero);
		localStorage.setItem('MOSTRAR_CELULAR', "si");
		barralateral.close();
		document.getElementById("restablecernomostrar").style.visibility="hidden";
	};	
	
	//Funci√≥n No Volver a mostrar sugerencia para girar el celular
	function VerificarNoVolverAMostrar(){
		if (Version !== (localStorage.getItem('MOSTRAR_INICIAL') || null)) {ModalFlash(tiempomodalflash);document.getElementById("restablecernomostrar").style.visibility="hidden"} else {document.getElementById("borrableinicial").style.display="none";document.getElementById("borrablelonuevo").style.display="none";document.getElementById("restablecernomostrar").style.visibility="visible"};
		if (localStorage.getItem('MOSTRAR_CELULAR') !=="no" && dispositivo !=="pc") {modalinicial.showModal();document.getElementById("restablecernomostrar").style.visibility="hidden"} else {document.getElementById("borrablecelular").style.display="none";document.getElementById("restablecernomostrar").style.visibility="visible"};
		//if (Version !== (localStorage.getItem('MOSTRAR_NUEVO') || null)) {document.getElementById("flecharoja").style.visibility='visible';console.log(Version+localStorage.getItem('MOSTRAR_NUEVO'))} else {document.getElementById("flecharoja").style.visibility='hidden'};
		if (dispositivo=="movil") {document.getElementById("flecharoja").style.visibility='hidden'};
	};
	

	//Activar/Desactivar/Mostrar/Ocultar/Ejecutar lo que corresponda al iniciar
	document.getElementById("gpson").style.visibility='hidden';
	document.getElementById("cuadroestadisticasbarralateral").style.visibility='hidden';
	btnindicacionesmodalflash.style.display='none';
	cajadistancia.style.visibility='hidden';
	botoncentrado.style.display='none';
	document.getElementById("dondestoy").style.visibility='hidden';
	document.getElementById("botonnorte").style.visibility='hidden';
	document.getElementById("contenedorMediciones").style.visibility='hidden';
	document.getElementById("Conectividad").style.visibility='hidden';
	document.getElementById("BotonLimpiarPantalla").style.visibility='hidden';
	botondetallesruta.style.display='none';
	mimodalflash.style.display='none';
	mapa.removeControl(minimapamundial);
	VerificarConexion();
	VerificarVersion();
	CargarListbox();
	VerificarDispositivo();
	VerificarNoVolverAMostrar();
	if (dispositivo=="pc") {modalinicial.close()};
	if (!dispositivo=="pc" && !dispositivo=="movil") {dispositivo="desconocido"};
	window.addEventListener("load", async () => {
		const fd = new FormData();
		fd.append('dispositivo', dispositivo);
		fd.append('mapavisitado', 'INTA');
		try {
			const res = await fetch(contadorvisitasdrive, {
				method: 'POST',
				body: fd
			})
			.then(r => r.json())
			.then(({status, data}) => {
				cantidadvisitas.textContent = "Tu visita es la n√∫mero: "+data+"...!!!.-";
				visitas.textContent = "Tu visita es la n√∫mero: "+data+"...!!!.-";
			});
			try {
				//document.getElementById('cantidadvisitas').textContent = "Tu visita es la n√∫mero: "+data.nuevoValor;
				//document.getElementById('visitas').textContent = "Tu visita es la n√∫mero: "+data.nuevoValor;
			} catch(e) {}
		} catch (err) {
			//enviando.textContent = 'Hubo un error; por lo que no se pudo enviar la informaci√≥n. Por favor, intentalo nuevamente.-';
		}
	});
	//ActualizarVisitas();
</script>
<script src="assets/dist/js/bootstrap.bundle.min.js"></script>
</html>